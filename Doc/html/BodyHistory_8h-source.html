<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>NewVision: BodyHistory.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>BodyHistory.h</h1><div class="fragment"><pre>00001 <span class="comment">/* ======================================================================================</span>
00002 <span class="comment">BODYHISTORY - is a record of all body paths</span>
00003 <span class="comment"></span>
00004 <span class="comment">BODYPATH - Is a list of body coordinates and other parameters recorded at each frame</span>
00005 <span class="comment">of the tracking process.</span>
00006 <span class="comment">======================================================================================== */</span>
00007 
00008 <span class="preprocessor">#if !defined( BODYHISTORY_H )</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#define BODYHISTORY_H</span>
00010 <span class="preprocessor"></span><span class="preprocessor">#pragma once</span>
00011 <span class="preprocessor"></span>
00012 <span class="preprocessor">#include &lt;afxtempl.h&gt;</span>
00013 <span class="preprocessor">#include "cv.h"</span>
00014 <span class="preprocessor">#include "SmartPtrArray.h"</span>
00015 
00016 <span class="keyword">class </span>Body;
00017 <span class="keyword">class </span>FloorModel;
00018 <span class="keyword">class </span>TrackerModel;
00019 <span class="keyword">class </span>CNewVisionDoc;
00020 
00021 <span class="preprocessor">#define DWELL_POINT_SCALE 0.8   </span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define DWELL_POINT_MAX_R 15</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define DWELL_POINT_COLOR CV_RGB(200, 170, 10)</span>
00024 <span class="preprocessor"></span>
00025 <span class="keyword">struct </span>Step {
00026     Step() {this-&gt;dwell = <span class="keyword">false</span>;};
00027     Step(CvPoint2D32f p, <span class="keywordtype">double</span> height, <span class="keywordtype">double</span> width, <span class="keywordtype">double</span> orientation, <span class="keywordtype">bool</span> visible=<span class="keyword">true</span>) {
00028         this-&gt;p = p;
00029         this-&gt;height = height;
00030         this-&gt;width = width;
00031         this-&gt;orientation = orientation;
00032         this-&gt;dwell = <span class="keyword">false</span>;
00033         this-&gt;visible = visible;
00034     }
00035     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Serialize(CArchive&amp; ar) {
00036         <span class="keywordflow">if</span> (ar.IsStoring()) ar &lt;&lt; p.x &lt;&lt; p.y &lt;&lt; height &lt;&lt; width &lt;&lt; orientation &lt;&lt; dwell &lt;&lt; visible;
00037         <span class="keywordflow">else</span> ar &gt;&gt; p.x &gt;&gt; p.y &gt;&gt; height &gt;&gt; width &gt;&gt; orientation &gt;&gt; dwell &gt;&gt; visible;
00038     }
00039     CvPoint2D32f p;
00040     <span class="keywordtype">double</span> height;
00041     <span class="keywordtype">double</span> width;
00042     <span class="keywordtype">double</span> orientation;
00043     <span class="keywordtype">bool</span> dwell;
00044     <span class="keywordtype">bool</span> visible;
00045     CvPoint p1, p2; <span class="comment">// temp</span>
00046 };
00047 <span class="comment">// --------------------------------------------------------------------------</span>
00048 <span class="keyword">class </span>BodyPath : <span class="keyword">public</span> CArray &lt; Step &gt; 
00049 {
00050     DECLARE_SERIAL(BodyPath)
00051 <span class="keyword">public</span>:
00052     <span class="keywordtype">int</span> id;          <span class="comment">// unique body id</span>
00053     <span class="keywordtype">int</span> groupid;     <span class="comment">// the group it belongs to</span>
00054     <span class="keywordtype">int</span> startFrame;  <span class="comment">// number of start frame</span>
00055     
00056     BodyPath(<span class="keywordtype">int</span> id, CvPoint2D32f p, <span class="keywordtype">int</span> startFrame, <span class="keywordtype">double</span> height, <span class="keywordtype">double</span> width, <span class="keywordtype">double</span> orientation, <span class="keywordtype">bool</span> visible=<span class="keyword">true</span>);
00057     BodyPath(<span class="keywordtype">void</span>);
00058     BodyPath&amp; operator=(<span class="keyword">const</span> BodyPath&amp; that);
00059     
00060     <span class="keyword">virtual</span> ~BodyPath(<span class="keywordtype">void</span>);
00061     <span class="keywordtype">void</span> Add(CvPoint2D32f p, <span class="keywordtype">double</span> height, <span class="keywordtype">double</span> width, <span class="keywordtype">double</span> orientation, <span class="keywordtype">bool</span> visible=<span class="keyword">true</span>);
00062     <span class="keywordtype">void</span> Draw(IplImage* frame, CvScalar color, FloorModel* fm, TrackerModel* tm, <span class="keywordtype">int</span> sigma);
00063     CvPoint2D32f Smooth(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> sigma);
00064     <span class="keywordtype">bool</span> ComputeDwellingState(<span class="keywordtype">int</span> nFrame, <span class="keywordtype">int</span> sigma, <span class="keywordtype">int</span> dwellFrames, <span class="keywordtype">double</span> dwellAreaRadius);
00065     <span class="keywordtype">bool</span> IsDwelling(<span class="keywordtype">int</span> nFrame);
00066     <span class="keywordtype">double</span> GetHeight();
00067     <span class="keywordtype">double</span> GetWidth();
00068     <span class="keywordtype">void</span> GetDwellLocations(CArray&lt;CvPoint2D32f&gt; &amp;dwellLocation, CArray&lt;int&gt; &amp;dwellFrame, CArray&lt;int&gt; &amp;dwellDuration);
00069     <span class="keywordtype">int</span> GetLastVisibleFrame();
00070     <span class="keywordtype">double</span> Compare(BodyPath* that);
00071     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Serialize(CArchive&amp; ar);
00072 };
00073 <span class="comment">// --------------------------------------------------------------------------</span>
00074 <span class="keyword">class </span>BodyHistory : <span class="keyword">public</span> SmartPtrArray&lt;BodyPath&gt; {
00075     
00076 <span class="keyword">public</span>:
00077     <span class="keywordtype">void</span> Export(<span class="keywordtype">int</span> nFrame);
00078     <span class="keywordtype">void</span> Import(<span class="keywordtype">int</span> nFrame);
00079     <span class="keywordtype">void</span> ImportFromCVML(CString filename);
00080     <span class="keywordtype">void</span> ExportToCVML(CString filename);
00081     <span class="keywordtype">void</span> ExportToCSV(CString fname);
00082     <span class="keywordtype">void</span> Empty();
00083 }bodyHistory;
00084 
00085 <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> AFXAPI SerializeElements &lt;BodyPath*&gt; ( CArchive&amp; ar, BodyPath** p, INT_PTR nCount );
00086 <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> AFXAPI SerializeElements &lt;Step&gt; ( CArchive&amp; ar, Step* p, INT_PTR nCount );
00087 <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> AFXAPI SerializeElements &lt;CvPoint2D32f&gt; ( CArchive&amp; ar, CvPoint2D32f* p, INT_PTR nCount );
00088 <span class="preprocessor">#endif // !defined( BODYHISTORY_H )</span>
</pre></div><hr><address style="align: right;"><small>
Generated on Mon May 15 16:43:42 2006 for NewVision by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>New Vision: F:/My Documents/Visual Studio 2005/Projects/NewVision/NewVision/TrackerModel.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>F:/My Documents/Visual Studio 2005/Projects/NewVision/NewVision/TrackerModel.cpp</h1><a href="_tracker_model_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="_std_afx_8h.html">StdAfx.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="_tracker_model_8h.html">TrackerModel.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "vfw.h"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_new_vision_8h.html">NewVision.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="_new_vision_doc_8h.html">NewVisionDoc.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="_new_vision_view_8h.html">NewVisionView.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="_body_model_8h.html">BodyModel.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="_body_8h.html">Body.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="_body_path_8h.html">BodyPath.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_main_frm_8h.html">MainFrm.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_globals_8h.html">Globals.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_cylinder_8h.html">Cylinder.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#using &lt;mscorlib.dll&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#using &lt;System.dll&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#include &lt;dvdmedia.h&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">using namespace </span>System;
<a name="l00024"></a>00024 <span class="keyword">using namespace </span>System::Diagnostics;
<a name="l00025"></a>00025 <span class="keyword">using namespace </span>System::IO;
<a name="l00026"></a>00026 <span class="keyword">using namespace </span>System::Threading;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 IMPLEMENT_SERIAL(<a class="code" href="class_tracker_model.html">TrackerModel</a>, <a class="code" href="class_model.html">Model</a>, 1)
<a name="l00029"></a>00029 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00030"></a><a class="code" href="class_tracker_model.html#dba2a335a62d50630103f42748d71276">00030</a> bool <a class="code" href="class_tracker_model.html">TrackerModel</a>::Initialize() {
<a name="l00031"></a>00031         <span class="keywordflow">if</span> (m_initialized)
<a name="l00032"></a>00032                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         <span class="keywordflow">if</span> (!<a class="code" href="class_sequence_processor.html#c6042fbffcd47f0b8f7cf64640346beb">SequenceProcessor::Initialize</a>()) 
<a name="l00035"></a>00035                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         <span class="comment">// Initialize Images </span>
<a name="l00038"></a>00038         CvSize sz               = cvSize(cx, cy);       
<a name="l00039"></a>00039         <a class="code" href="_globals_8cpp.html#2c1daf0060e820291887bbfbc2f20d93">imgVideo</a>                = cvCreateImageHeader(sz, IPL_DEPTH_8U, 3);     
<a name="l00040"></a>00040         
<a name="l00042"></a>00042         <span class="comment">//if (m_mode == TRGBFILE)</span>
<a name="l00043"></a>00043         <span class="comment">//      sz.width /= 2;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>                = cvCreateImage(sz, IPL_DEPTH_8U, 3);   
<a name="l00046"></a>00046         <span class="comment">// Set OpenCV image origin (TopLeft or BottomLeft)</span>
<a name="l00047"></a>00047         <span class="comment">//((VIDEOINFOHEADER *) (m_mediaType.pbFormat))-&gt;bmiHeader.biHeight &gt; 0 ? imgFrame-&gt;origin = 1 : imgFrame-&gt;origin = 0;</span>
<a name="l00048"></a>00048         <a class="code" href="_globals_8cpp.html#584da8b9415f64f97217716dec8fe056">imgThermal</a>              = cvCreateImage(sz, IPL_DEPTH_8U, 1);   
<a name="l00049"></a>00049         <a class="code" href="_globals_8cpp.html#5a47e483b039901030ea425eedfa3863">FGMap</a>                   = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00050"></a>00050         <a class="code" href="_globals_8cpp.html#f85f7a91e64f4578130ccde67fe1fd44">dilated</a>                 = cvCreateImage(sz, IPL_DEPTH_8U, 1);   
<a name="l00051"></a>00051         <a class="code" href="_globals_8cpp.html#1b6c84cbc3cb7aa5cc4e6d14d843ddde">mask</a>                    = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00052"></a>00052         <a class="code" href="_globals_8cpp.html#ed0a25c4726f54bf1a5e699df4711a62">weight</a>                  = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00053"></a>00053         <a class="code" href="_globals_8cpp.html#99cc519e9141cad8ba5e5e6a5bff3c4a">l_plane</a>                 = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00054"></a>00054         <a class="code" href="_globals_8cpp.html#5d423cfb46d05cc549d416b92a431710">a_plane</a>                 = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00055"></a>00055         <a class="code" href="_globals_8cpp.html#bf127f410199a5c8e71e4ce06e241b5e">b_plane</a>                 = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00056"></a>00056         <a class="code" href="_globals_8cpp.html#96e982ff176958ec197a50586ee65368">fg</a>                              = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00057"></a>00057         <a class="code" href="_globals_8cpp.html#7fa38479663d065faad9145a4017f930">bg</a>                              = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00058"></a>00058         <a class="code" href="_globals_8cpp.html#de2979bbac1fc6254835496289660e23">zbuffer</a>                 = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00059"></a>00059         <a class="code" href="_globals_8cpp.html#b2ce9da27e1d5727e29e8ef30329a08d">body_zbuffer</a>    = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00060"></a>00060         <a class="code" href="_globals_8cpp.html#4b2d4e55b64a28d4ac0b4e0a734d9f7a">temp</a>                    = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00061"></a>00061         <a class="code" href="_globals_8cpp.html#b13f2b886610f4d3127d5d3903c06bd6">body_mask</a>               = cvCreateImage(sz, IPL_DEPTH_8U, 1);
<a name="l00062"></a>00062         <a class="code" href="_globals_8cpp.html#4e26626ca1309461c668a7b28787dc5f">blob_mask</a>               = cvCreateImage(sz, IPL_DEPTH_8U, 1);   
<a name="l00063"></a>00063         <a class="code" href="_globals_8cpp.html#29ec4a325afbbe62623c810a33dbb564">obstacle_disp</a>   = cvCreateImage(sz, IPL_DEPTH_8U, 1);   
<a name="l00064"></a>00064         <a class="code" href="_globals_8cpp.html#8270498a05616350ed2717881b011bbd">door_mask</a>               = cvCreateImage(sz, IPL_DEPTH_8U, 1);   
<a name="l00065"></a>00065         <a class="code" href="_globals_8cpp.html#0c575e5a96aee255ada87d30446af873">distance_mask</a>   = cvCreateImage(sz, IPL_DEPTH_32F, 1);  
<a name="l00066"></a>00066         <a class="code" href="_globals_8cpp.html#30b461669697d8dbf699f2acbb056e38">velx</a>                    = cvCreateImage(sz, IPL_DEPTH_32F, 1);  
<a name="l00067"></a>00067         <a class="code" href="_globals_8cpp.html#ac3c793deb9054dff831a820b070c944">vely</a>                    = cvCreateImage(sz, IPL_DEPTH_32F, 1);  
<a name="l00068"></a>00068         <a class="code" href="_globals_8cpp.html#a9f64915905aa5943f6805b0a290b0da">temp32</a>                  = cvCreateImage(sz, IPL_DEPTH_32F, 1);
<a name="l00069"></a>00069         <a class="code" href="_globals_8cpp.html#1e3fbd95634d139089c0708491488f3f">FGMapDouble</a>             = cvCreateImage(sz, IPL_DEPTH_32F, 1);  
<a name="l00070"></a>00070         <a class="code" href="_globals_8cpp.html#b5812ee44d5a60a3a859201f2647d7ec">ibg</a>                             = cvCreateImage(sz, IPL_DEPTH_32F, 1);
<a name="l00071"></a>00071         <a class="code" href="_globals_8cpp.html#5f4f09b989fa2c50769ee80e11c1f343">ifg</a>                             = cvCreateImage(sz, IPL_DEPTH_32F, 1);
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="comment">//      imgVideo                = cvCreateImage(sz, IPL_DEPTH_8U, 3);   </span>
<a name="l00074"></a>00074         <a class="code" href="_globals_8cpp.html#b536882a7f353e0dccff1d0ae911cc47">imgOverlayInfo</a>  = cvCreateImage(sz, IPL_DEPTH_8U, 3);   
<a name="l00075"></a>00075         <a class="code" href="_globals_8cpp.html#c81400178452b0dd6e63cc7c21274ba4">imgPreviousFrame</a>= cvCreateImage(sz, IPL_DEPTH_8U, 3);   
<a name="l00076"></a>00076         <a class="code" href="_globals_8cpp.html#bceafe51b6d9c4a220970416a978dd5f">sceneImg</a>                = cvCreateImage(sz, IPL_DEPTH_8U, 3);   
<a name="l00077"></a>00077         <a class="code" href="_globals_8cpp.html#ef90b4cd081224294b7f573929d7a6ef">activityImg</a>     = cvCreateImage(sz, IPL_DEPTH_8U, 3);   
<a name="l00078"></a>00078         <a class="code" href="_globals_8cpp.html#e82d22fddf80312ba208fc65d234e5e3">blobImg</a>                 = cvCreateImage(sz, IPL_DEPTH_8U, 3);   
<a name="l00079"></a>00079         <a class="code" href="_globals_8cpp.html#3b9d3337b1e65b6138ba091e21afa26c">lab</a>                             = cvCreateImage(sz, IPL_DEPTH_8U, 3);
<a name="l00080"></a>00080         <a class="code" href="_globals_8cpp.html#e70c51ae7e2d2d20d7e29b5160f32a49">biggy</a>                   = cvCreateImage(sz, IPL_DEPTH_32F, 3);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="comment">// Initialize Supporting Structures</span>
<a name="l00083"></a>00083         __time64_t tmp_time;
<a name="l00084"></a>00084         <a class="code" href="_globals_8cpp.html#ff39e3308132c1b3c9548c6bbdf21b55">rnd_seed</a> = cvRNG(_time64(&amp;tmp_time));
<a name="l00085"></a>00085         <span class="comment">//rnd_seed = cvRNG(-1);</span>
<a name="l00086"></a>00086         <a class="code" href="_globals_8cpp.html#57efc8aa770b061bfa5f6ba9dc673ef3">OpenCVmemory</a> = cvCreateMemStorage(0);
<a name="l00087"></a>00087         <a class="code" href="_globals_8cpp.html#f95cf892bb79eb2031e5cba79ffec780">aviWriterInputView</a>              = NULL; 
<a name="l00088"></a>00088         <a class="code" href="_globals_8cpp.html#bcbbcb21b6b7ab30442fb1f6e1521508">aviWriterOutputView</a>             = NULL; 
<a name="l00089"></a>00089         <a class="code" href="_globals_8cpp.html#25af48ed52913ef8234be063ee9bfa3c">aviWriterActivityView</a>   = NULL; 
<a name="l00090"></a>00090         <a class="code" href="_globals_8cpp.html#4d49ecf232cc50dbf973cba352208686">aviWriterFloorView</a>              = NULL; 
<a name="l00091"></a>00091         m_record                                = <span class="keyword">false</span>;
<a name="l00092"></a>00092         m_initialized                   = <span class="keyword">true</span>;
<a name="l00093"></a>00093         m_frameLastProcessed    = m_frameNumber = m_frameStart;
<a name="l00094"></a>00094         SetPosition();
<a name="l00095"></a>00095         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00098"></a><a class="code" href="class_tracker_model.html#f21ffeefe7f715371a394494b21da256">00098</a> <span class="keywordtype">void</span> <a class="code" href="class_tracker_model.html#f21ffeefe7f715371a394494b21da256">TrackerModel::DeInitialize</a>() {
<a name="l00099"></a>00099         <span class="keywordflow">if</span> (!<a class="code" href="class_sequence_processor.html#f38d95c63ebfbc7cd98912351c83c349">m_initialized</a>)
<a name="l00100"></a>00100                 <span class="keywordflow">return</span>;
<a name="l00101"></a>00101         <span class="comment">//CAutoLock dataLock( &amp;m_dataCriticalSection); </span>
<a name="l00102"></a>00102         <a class="code" href="class_sequence_processor.html#bd64e498ae1154a46ed3680e4201b1c9">SequenceProcessor::DeInitialize</a>(); 
<a name="l00103"></a>00103         <span class="comment">// Release recording structures</span>
<a name="l00104"></a>00104         <span class="keywordflow">if</span> (<a class="code" href="class_sequence_processor.html#6427fd9ae3bc7a411c59ddc18d912c91">m_record</a>) {
<a name="l00105"></a>00105                 CAutoLock singleLock(&amp;<a class="code" href="_globals_8cpp.html#81ab688f99ba1694b87c00b969cf7057">m_RecordCriticalSection</a>);
<a name="l00106"></a>00106                 <a class="code" href="class_sequence_processor.html#6427fd9ae3bc7a411c59ddc18d912c91">m_record</a> = <span class="keyword">false</span>;
<a name="l00107"></a>00107                 <span class="comment">//cvReleaseImage(&amp;rec);</span>
<a name="l00108"></a>00108         }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <span class="comment">// Release images and buffers</span>
<a name="l00111"></a>00111         cvReleaseMemStorage(&amp;<a class="code" href="_globals_8cpp.html#57efc8aa770b061bfa5f6ba9dc673ef3">OpenCVmemory</a>); 
<a name="l00112"></a>00112         cvReleaseImageHeader(&amp;<a class="code" href="_globals_8cpp.html#2c1daf0060e820291887bbfbc2f20d93">imgVideo</a>);
<a name="l00113"></a>00113         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>);
<a name="l00114"></a>00114         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#e82d22fddf80312ba208fc65d234e5e3">blobImg</a>);
<a name="l00115"></a>00115         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#f85f7a91e64f4578130ccde67fe1fd44">dilated</a>);
<a name="l00116"></a>00116         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#5a47e483b039901030ea425eedfa3863">FGMap</a>);
<a name="l00117"></a>00117         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#1e3fbd95634d139089c0708491488f3f">FGMapDouble</a>);
<a name="l00118"></a>00118         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#b536882a7f353e0dccff1d0ae911cc47">imgOverlayInfo</a>);
<a name="l00119"></a>00119         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#584da8b9415f64f97217716dec8fe056">imgThermal</a>);
<a name="l00120"></a>00120         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#bceafe51b6d9c4a220970416a978dd5f">sceneImg</a>);
<a name="l00121"></a>00121         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#ef90b4cd081224294b7f573929d7a6ef">activityImg</a>);
<a name="l00122"></a>00122         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#c81400178452b0dd6e63cc7c21274ba4">imgPreviousFrame</a>);
<a name="l00123"></a>00123         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#99cc519e9141cad8ba5e5e6a5bff3c4a">l_plane</a>); cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#5d423cfb46d05cc549d416b92a431710">a_plane</a>); cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#bf127f410199a5c8e71e4ce06e241b5e">b_plane</a>);
<a name="l00124"></a>00124         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#1b6c84cbc3cb7aa5cc4e6d14d843ddde">mask</a>); cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#3b9d3337b1e65b6138ba091e21afa26c">lab</a>); cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#ed0a25c4726f54bf1a5e699df4711a62">weight</a>); 
<a name="l00125"></a>00125         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#96e982ff176958ec197a50586ee65368">fg</a>);cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#7fa38479663d065faad9145a4017f930">bg</a>);cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#de2979bbac1fc6254835496289660e23">zbuffer</a>);cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#b2ce9da27e1d5727e29e8ef30329a08d">body_zbuffer</a>);
<a name="l00126"></a>00126         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#4b2d4e55b64a28d4ac0b4e0a734d9f7a">temp</a>);
<a name="l00127"></a>00127         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#b13f2b886610f4d3127d5d3903c06bd6">body_mask</a>);     cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#4e26626ca1309461c668a7b28787dc5f">blob_mask</a>);
<a name="l00128"></a>00128         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#8270498a05616350ed2717881b011bbd">door_mask</a>);
<a name="l00129"></a>00129         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#0c575e5a96aee255ada87d30446af873">distance_mask</a>);
<a name="l00130"></a>00130         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#29ec4a325afbbe62623c810a33dbb564">obstacle_disp</a>);
<a name="l00131"></a>00131         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#30b461669697d8dbf699f2acbb056e38">velx</a>);
<a name="l00132"></a>00132         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#ac3c793deb9054dff831a820b070c944">vely</a>);
<a name="l00133"></a>00133         cvReleaseImage(&amp;<a class="code" href="_globals_8cpp.html#a9f64915905aa5943f6805b0a290b0da">temp32</a>);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <a class="code" href="class_sequence_processor.html#f38d95c63ebfbc7cd98912351c83c349">m_initialized</a> = <span class="keyword">false</span>;
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00138"></a><a class="code" href="class_tracker_model.html#d8cab3b70d1465928852dc3e66bbc4c7">00138</a> <span class="keywordtype">void</span> <a class="code" href="class_tracker_model.html#d8cab3b70d1465928852dc3e66bbc4c7">TrackerModel::ReleaseVideoWriters</a>() {
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#f95cf892bb79eb2031e5cba79ffec780">aviWriterInputView</a>)
<a name="l00140"></a>00140                 cvReleaseVideoWriter(&amp;<a class="code" href="_globals_8cpp.html#f95cf892bb79eb2031e5cba79ffec780">aviWriterInputView</a>);
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#bcbbcb21b6b7ab30442fb1f6e1521508">aviWriterOutputView</a>)
<a name="l00142"></a>00142                 cvReleaseVideoWriter(&amp;<a class="code" href="_globals_8cpp.html#bcbbcb21b6b7ab30442fb1f6e1521508">aviWriterOutputView</a>);
<a name="l00143"></a>00143         <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#25af48ed52913ef8234be063ee9bfa3c">aviWriterActivityView</a>)
<a name="l00144"></a>00144                 cvReleaseVideoWriter(&amp;<a class="code" href="_globals_8cpp.html#25af48ed52913ef8234be063ee9bfa3c">aviWriterActivityView</a>);
<a name="l00145"></a>00145         <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#4d49ecf232cc50dbf973cba352208686">aviWriterFloorView</a>)
<a name="l00146"></a>00146                 cvReleaseVideoWriter(&amp;<a class="code" href="_globals_8cpp.html#4d49ecf232cc50dbf973cba352208686">aviWriterFloorView</a>);
<a name="l00147"></a>00147         aviWriterInputView = NULL; aviWriterOutputView = NULL; aviWriterActivityView  = NULL; aviWriterFloorView  = NULL; 
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00150"></a><a class="code" href="class_tracker_model.html#8460d0ec34e584600a34692ffc63ad67">00150</a> <a class="code" href="class_tracker_model.html#8460d0ec34e584600a34692ffc63ad67">TrackerModel::TrackerModel</a>() {
<a name="l00151"></a>00151         <a class="code" href="class_sequence_processor.html#f38d95c63ebfbc7cd98912351c83c349">m_initialized</a> = <span class="keyword">false</span>;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00154"></a><a class="code" href="class_tracker_model.html#b7c2f700aff838f55337f86a86c21a05">00154</a> <a class="code" href="class_tracker_model.html#b7c2f700aff838f55337f86a86c21a05">TrackerModel::~TrackerModel</a>(<span class="keywordtype">void</span>)       {
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00157"></a><a class="code" href="class_tracker_model.html#357c0075e6e2c72e54b1e2ded85c0600">00157</a> HRESULT <a class="code" href="class_tracker_model.html#357c0075e6e2c72e54b1e2ded85c0600">TrackerModel::SampleCB</a>(<span class="keywordtype">double</span> SampleTime, IMediaSample *pSample) {
<a name="l00158"></a>00158         <span class="comment">//signalEvent(colorImageReady);</span>
<a name="l00159"></a>00159  <span class="comment">//     WaitForSingleObject(thermalImageReady);</span>
<a name="l00160"></a>00160         <span class="keywordflow">if</span> (FAILED(<a class="code" href="class_sequence_processor.html#3c7c8213a696931abf7f11878c95402f">SequenceProcessor::SampleCB</a>(SampleTime, pSample)))
<a name="l00161"></a>00161                 <span class="keywordflow">return</span> S_FALSE;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="comment">// THE DEAL: Ok, following is a hack to steer clear from DirectShow+Codecs bugs:</span>
<a name="l00164"></a>00164         <span class="comment">// Problem 1: SetPositions() causes this method to be called twice. This calling twice issue occurs only when using VMR9, with VMR7 or just renderer is works ok!</span>
<a name="l00165"></a>00165         <span class="comment">// Problem 2: SampleTime and pSample differ based on the codec used and the machine on which it is invoked</span>
<a name="l00166"></a>00166         <span class="comment">// SampleTime is correct with FFDShow if using ceiling value, but pSample-&gt;GetMediaTime() lies every 3000 frames adds 1</span>
<a name="l00167"></a>00167         <span class="comment">// Seems to be NOT! working with DivX codec (the first call must be ignored, the second one is correct), </span>
<a name="l00168"></a>00168         <span class="comment">// BUT! some strange behaviour occurs sometimes</span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="comment">// wait for the thermal image to be ready</span>
<a name="l00171"></a>00171         <span class="keywordtype">int</span> SYNC_SLEEP_TIME = 1;
<a name="l00172"></a>00172         <span class="keywordflow">if</span> (<a class="code" href="class_sequence_processor.html#732380bd0e948150b1fd25dbdeea1e65">m_mode</a> == <a class="code" href="_sequence_processor_8h.html#e2db23c83963e6efb422f5a651b065a83013c41b32f076093a3bdfc2bb414e33">TRGBFILE</a>)
<a name="l00173"></a>00173                 <span class="keywordflow">while</span> (<a class="code" href="class_sequence_processor.html#49ed8aaa283c200b42dc5b6a6c3f1149">thermalGrabber</a>-&gt;<a class="code" href="class_thermal_grabber.html#912c231e0f04a4b3911a02a5f0a09b4d">m_frameNumber</a> &lt; <a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a> &amp;&amp; !<a class="code" href="class_sequence_processor.html#aab42ff01d3157ec488b84d3822f2a88">m_isSettingPositions</a>)
<a name="l00174"></a>00174                         ::Sleep( SYNC_SLEEP_TIME );
<a name="l00175"></a>00175         CAutoLock thermalLock( &amp;<a class="code" href="_globals_8cpp.html#e52d115bac8b6e7fde8f0b90f54e2caa">m_thermalCriticalSection</a>);      
<a name="l00176"></a>00176         <a class="code" href="class_sequence_processor.html#aab42ff01d3157ec488b84d3822f2a88">m_isSettingPositions</a> = 0;
<a name="l00177"></a>00177 <span class="comment">//      echo(String::Format("thermal {1}   color {0}",m_frameNumber, thermalGrabber-&gt;m_frameNumber));</span>
<a name="l00178"></a>00178         <a class="code" href="class_tracker_model.html#634616ed84414eb65349260b15ea570a">RunTracker</a>();
<a name="l00179"></a>00179         <span class="keywordflow">return</span> S_OK;
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00182"></a><a class="code" href="class_tracker_model.html#634616ed84414eb65349260b15ea570a">00182</a> <span class="keywordtype">void</span> <a class="code" href="class_tracker_model.html#634616ed84414eb65349260b15ea570a">TrackerModel::RunTracker</a>() {
<a name="l00183"></a>00183         <span class="comment">// --------------- Process or playback -----------------------------</span>
<a name="l00184"></a>00184         { <span class="comment">// +++ begin data processing critical section </span>
<a name="l00185"></a>00185                 CAutoLock dataLock( &amp;<a class="code" href="_globals_8cpp.html#a0f75ae54b393b909243994947275961">m_dataCriticalSection</a>); 
<a name="l00186"></a>00186                 <span class="keywordflow">if</span> (<a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#2dcf6b942e9dd7e1b1ef000e661870a3">m_initialized</a>) <span class="keywordflow">switch</span> (<a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#ff846febb9584b5b4fd4850b1b891827">m_ProcessingMode</a>) {
<a name="l00187"></a>00187                         <span class="keywordflow">case</span> <a class="code" href="_new_vision_doc_8h.html#1c2b96eed57c1a07443e4877a8e53f125b83dded44924a6ef0fc0c08bac2c232">TRACKING</a>: {
<a name="l00188"></a>00188                                 <span class="keywordflow">if</span> (<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a> &lt; <a class="code" href="class_sequence_processor.html#4488a608e0e930c5e16983aa82a9bb8c">m_frameLastProcessed</a>)
<a name="l00189"></a>00189                                         <a class="code" href="_new_vision_8cpp.html#d9838dffd526077fa9aa869c36a82332">theApp</a>.m_pMainWnd-&gt;PostMessage(<a class="code" href="_main_frm_8h.html#aad714f34cbc0a15564e709285ffd2c4">WM_LOADLASTFRAME</a>);
<a name="l00190"></a>00190                                 <span class="keywordflow">if</span> (<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a> &gt; <a class="code" href="class_sequence_processor.html#4488a608e0e930c5e16983aa82a9bb8c">m_frameLastProcessed</a>) {
<a name="l00191"></a>00191                                         cvClearMemStorage(<a class="code" href="_globals_8cpp.html#57efc8aa770b061bfa5f6ba9dc673ef3">OpenCVmemory</a>);
<a name="l00192"></a>00192                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#4cfbcea83df819d576d091eea82494a6">bgmodel</a>.<a class="code" href="class_background_model.html#cdab00efad2fd4e21855116f6c6bf458">Update</a>((<span class="keywordtype">int</span>)<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a>);
<a name="l00193"></a>00193                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#4cfbcea83df819d576d091eea82494a6">bgmodel</a>.<a class="code" href="class_background_model.html#f8502d878e46f30ce969a66b7f595955">SubtractBackground</a>(<a class="code" href="_globals_8cpp.html#5a47e483b039901030ea425eedfa3863">FGMap</a>, (<span class="keywordtype">int</span>)m_frameNumber);
<a name="l00194"></a>00194                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#b16361836a42ce1853622cd74d654d49">blobmodel</a>.<a class="code" href="class_blob_model.html#48f5f7283a4dd05437491a97cfd6ca96">FindBlobs</a>(<a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>, <a class="code" href="_globals_8cpp.html#5a47e483b039901030ea425eedfa3863">FGMap</a>);
<a name="l00195"></a>00195                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#c05200bcc948d3bc2e39fd0532595117">bodymodel</a>.<a class="code" href="class_body_model.html#610077e7329d52e2f9797ef47420804f">Predict</a>(); 
<a name="l00196"></a>00196                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#d3222dcea9c548810d510aff46b91680">m_TrackingData</a>.<a class="code" href="class_tracking_data.html#66cc6d16ca8f6704408d53ac0b0287a4">Put</a>((<span class="keywordtype">int</span>)m_frameNumber);
<a name="l00197"></a>00197                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#843526ae3c032f8c17705ce009fbbb8d">AutoSave</a>();
<a name="l00198"></a>00198                                 }
<a name="l00199"></a>00199                                 <span class="keywordflow">break</span>;
<a name="l00200"></a>00200                         }
<a name="l00201"></a>00201                         <span class="keywordflow">case</span> <a class="code" href="_new_vision_doc_8h.html#1c2b96eed57c1a07443e4877a8e53f12572ae2317b5c81f10926f3f068bd1fcd">HEATMAP</a>: {
<a name="l00202"></a>00202                                 <span class="keywordflow">if</span> (<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a> &lt; <a class="code" href="class_sequence_processor.html#4488a608e0e930c5e16983aa82a9bb8c">m_frameLastProcessed</a>)
<a name="l00203"></a>00203                                         <a class="code" href="_new_vision_8cpp.html#d9838dffd526077fa9aa869c36a82332">theApp</a>.m_pMainWnd-&gt;PostMessage(<a class="code" href="_main_frm_8h.html#aad714f34cbc0a15564e709285ffd2c4">WM_LOADLASTFRAME</a>);
<a name="l00204"></a>00204                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a> &gt; <a class="code" href="class_sequence_processor.html#4488a608e0e930c5e16983aa82a9bb8c">m_frameLastProcessed</a>) {
<a name="l00205"></a>00205                                         cvClearMemStorage(<a class="code" href="_globals_8cpp.html#57efc8aa770b061bfa5f6ba9dc673ef3">OpenCVmemory</a>);
<a name="l00206"></a>00206                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#4cfbcea83df819d576d091eea82494a6">bgmodel</a>.<a class="code" href="class_background_model.html#cdab00efad2fd4e21855116f6c6bf458">Update</a>((<span class="keywordtype">int</span>)<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a>);
<a name="l00207"></a>00207                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#4cfbcea83df819d576d091eea82494a6">bgmodel</a>.<a class="code" href="class_background_model.html#f8502d878e46f30ce969a66b7f595955">SubtractBackground</a>(<a class="code" href="_globals_8cpp.html#5a47e483b039901030ea425eedfa3863">FGMap</a>, (<span class="keywordtype">int</span>)m_frameNumber);
<a name="l00208"></a>00208                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#b16361836a42ce1853622cd74d654d49">blobmodel</a>.<a class="code" href="class_blob_model.html#48f5f7283a4dd05437491a97cfd6ca96">FindBlobs</a>(<a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>, <a class="code" href="_globals_8cpp.html#5a47e483b039901030ea425eedfa3863">FGMap</a>);
<a name="l00209"></a>00209                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#b16361836a42ce1853622cd74d654d49">blobmodel</a>.<a class="code" href="class_blob_model.html#9a78e0b213e65587b1f4d5d0c81bda8f">UpdateHeatMap</a>(<a class="code" href="_globals_8cpp.html#a751ca4ad3088ff7eb927161c0615860">motionmap</a>);
<a name="l00210"></a>00210                                         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#28f8e0b2eb7b931a90e307ad4cda3802">m_HeatmapData</a>.<a class="code" href="class_heatmap_data.html#41023b3877cf0f8fb122f70f8b11e856">Put</a>((<span class="keywordtype">int</span>)m_frameNumber);
<a name="l00211"></a>00211                                 }
<a name="l00212"></a>00212                                 <span class="keywordflow">break</span>;
<a name="l00213"></a>00213                         }
<a name="l00214"></a>00214                         <span class="keywordflow">case</span> <a class="code" href="_new_vision_doc_8h.html#1c2b96eed57c1a07443e4877a8e53f12995d34bcabbc4f6dd5347f17464c4a2f">ACTIVITY</a>: {
<a name="l00215"></a>00215                                 <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#d3222dcea9c548810d510aff46b91680">m_TrackingData</a>.<a class="code" href="class_tracking_data.html#16ad14f7f11531b6581e1689d4537128">Get</a>((<span class="keywordtype">int</span>)<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a>);
<a name="l00216"></a>00216                                 <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#d5acf3ec790c58f8fe3978a16f519ea0">bodyactivitymodel</a>.<a class="code" href="class_body_activity_model.html#7b34e5af6638714c9b7cf085aeca186a">DetectEvents</a>((<span class="keywordtype">int</span>)m_frameNumber);
<a name="l00217"></a>00217                                 <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#2bbd8fc9b250d9b39a3eb63f88f980b2">swarmactivitymodel</a>.<a class="code" href="class_swarm_activity_model.html#ebcf9a8219c1d902b1ec1bed3c4401ee">DetectEvents</a>((<span class="keywordtype">int</span>)m_frameNumber);
<a name="l00218"></a>00218                                 <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#429e801a3408d444c25ad38e43a0b982">m_ActivityData</a>.<a class="code" href="class_activity_data.html#e2e1c3a84e28f67c73f60cdb809d04ab">Put</a>((<span class="keywordtype">int</span>)m_frameNumber);
<a name="l00219"></a>00219                                 <span class="keywordflow">break</span>;
<a name="l00220"></a>00220                         }
<a name="l00221"></a>00221                         <span class="keywordflow">case</span> <a class="code" href="_new_vision_doc_8h.html#1c2b96eed57c1a07443e4877a8e53f12d7b89910e75af4f6c3710d60105e42c4">PLAYBACK</a>: {
<a name="l00222"></a>00222                                 <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#d3222dcea9c548810d510aff46b91680">m_TrackingData</a>.<a class="code" href="class_tracking_data.html#16ad14f7f11531b6581e1689d4537128">Get</a>((<span class="keywordtype">int</span>)<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a>);
<a name="l00223"></a>00223                                 <span class="keywordflow">break</span>;
<a name="l00224"></a>00224                         }
<a name="l00225"></a>00225                 };
<a name="l00226"></a>00226         } <span class="comment">// +++ end data processing critical section           </span>
<a name="l00227"></a>00227         <span class="comment">// --------------- Display information -----------------------------</span>
<a name="l00228"></a>00228         <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#3cbef4f4abc95d87b09d572e8f2ded2e">UpdateOverlayInfo</a>();
<a name="l00229"></a>00229         <span class="keywordflow">if</span> (<a class="code" href="_new_vision_8cpp.html#d9838dffd526077fa9aa869c36a82332">theApp</a>.m_pMainWnd) {
<a name="l00230"></a>00230                 <a class="code" href="_new_vision_8cpp.html#d9838dffd526077fa9aa869c36a82332">theApp</a>.m_pMainWnd-&gt;PostMessage(<a class="code" href="_main_frm_8h.html#a1aa51125a570dd3e38ff2b86d9a0144">WM_UPDATENAVBAR</a>);
<a name="l00231"></a>00231                 <a class="code" href="_new_vision_8cpp.html#d9838dffd526077fa9aa869c36a82332">theApp</a>.m_pMainWnd-&gt;PostMessage(<a class="code" href="_main_frm_8h.html#0d22d46d56d0b451d6edbf0ab4e757cd">WM_UPDATESTATUSBAR</a>);
<a name="l00232"></a>00232         }
<a name="l00233"></a>00233         <span class="comment">// --------------- Record results ----------------------------------</span>
<a name="l00234"></a>00234         <a class="code" href="class_tracker_model.html#da437fbf1a3450e560f039d5dce0e7d2">RecordFrame</a>();
<a name="l00235"></a>00235         <span class="comment">// --------------- Archive and Cleanup -----------------------------</span>
<a name="l00236"></a>00236         <span class="keywordflow">if</span> (<a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#2dcf6b942e9dd7e1b1ef000e661870a3">m_initialized</a> &amp;&amp; <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#ff846febb9584b5b4fd4850b1b891827">m_ProcessingMode</a> != <a class="code" href="_new_vision_doc_8h.html#1c2b96eed57c1a07443e4877a8e53f12d7b89910e75af4f6c3710d60105e42c4">PLAYBACK</a>)
<a name="l00237"></a>00237                 cvCopy(<a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>, <a class="code" href="_globals_8cpp.html#c81400178452b0dd6e63cc7c21274ba4">imgPreviousFrame</a>);
<a name="l00238"></a>00238         <a class="code" href="class_sequence_processor.html#4488a608e0e930c5e16983aa82a9bb8c">m_frameLastProcessed</a> = max(<a class="code" href="class_sequence_processor.html#4488a608e0e930c5e16983aa82a9bb8c">m_frameLastProcessed</a>, <a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a>);
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00241"></a><a class="code" href="class_tracker_model.html#da437fbf1a3450e560f039d5dce0e7d2">00241</a> <span class="keywordtype">void</span> <a class="code" href="class_tracker_model.html#da437fbf1a3450e560f039d5dce0e7d2">TrackerModel::RecordFrame</a>() {
<a name="l00242"></a>00242         <span class="comment">// need a mutex here to block access to m_record from outside</span>
<a name="l00243"></a>00243         CAutoLock singleLock(&amp;<a class="code" href="_globals_8cpp.html#81ab688f99ba1694b87c00b969cf7057">m_RecordCriticalSection</a>);
<a name="l00244"></a>00244         <span class="keywordflow">if</span> (<a class="code" href="class_sequence_processor.html#6427fd9ae3bc7a411c59ddc18d912c91">m_record</a>) {
<a name="l00245"></a>00245                 <span class="comment">//int old_panel_type = ((CMainFrame*)(theApp.m_pMainWnd))-&gt;GetActivePane()-&gt;m_type;</span>
<a name="l00246"></a>00246                 <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#990eeff8801b044c01e083758069beca">m_recordVideoView</a>) {
<a name="l00247"></a>00247                         <span class="comment">//((CMainFrame*)(theApp.m_pMainWnd))-&gt;GetActivePane()-&gt;m_type = VIDEO_VIEW;</span>
<a name="l00249"></a>00249 <span class="comment"></span>                        <span class="comment">//doc-&gt;UpdateOverlayInfo();</span>
<a name="l00250"></a>00250                         <span class="comment">//Overlay2IplImage(m_bitmap, imgOverlayInfo);</span>
<a name="l00251"></a>00251                         cvWriteFrame(<a class="code" href="_globals_8cpp.html#f95cf892bb79eb2031e5cba79ffec780">aviWriterInputView</a>, <a class="code" href="_globals_8cpp.html#b536882a7f353e0dccff1d0ae911cc47">imgOverlayInfo</a><span class="comment">/*imgFrame*/</span>);
<a name="l00252"></a>00252                 }
<a name="l00253"></a>00253                 <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#f045954763fa8e81908b617a3fa461ec">m_recordSceneView</a>)
<a name="l00254"></a>00254                         cvWriteFrame(<a class="code" href="_globals_8cpp.html#bcbbcb21b6b7ab30442fb1f6e1521508">aviWriterOutputView</a>, <a class="code" href="_globals_8cpp.html#bceafe51b6d9c4a220970416a978dd5f">sceneImg</a>);
<a name="l00255"></a>00255                 <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#407224fd520503ebe109295474d2ef49">m_recordActivityView</a>)
<a name="l00256"></a>00256                         cvWriteFrame(<a class="code" href="_globals_8cpp.html#25af48ed52913ef8234be063ee9bfa3c">aviWriterActivityView</a>, <a class="code" href="_globals_8cpp.html#ef90b4cd081224294b7f573929d7a6ef">activityImg</a>);
<a name="l00257"></a>00257                 <span class="keywordflow">if</span> (<a class="code" href="_globals_8cpp.html#60bd71feae250882125e8313308d3ac0">m_recordFloorView</a>)
<a name="l00258"></a>00258                         cvWriteFrame(<a class="code" href="_globals_8cpp.html#4d49ecf232cc50dbf973cba352208686">aviWriterFloorView</a>, <a class="code" href="_globals_8cpp.html#313c8683a26490286935dc9b2c7794e3">floorImg</a>);
<a name="l00259"></a>00259                 <span class="comment">//((CMainFrame*)(theApp.m_pMainWnd))-&gt;GetActivePane()-&gt;m_type = old_panel_type;</span>
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00263"></a><a class="code" href="class_tracker_model.html#fdfb845d1fd8754840e3b7e2534fba89">00263</a> <span class="keywordtype">void</span> <a class="code" href="class_tracker_model.html#fdfb845d1fd8754840e3b7e2534fba89">TrackerModel::ShowTimeStamp</a>(IplImage* frame) {
<a name="l00264"></a>00264         CTimeSpan elapsed((<span class="keywordtype">int</span>)(<a class="code" href="class_sequence_processor.html#73f2908199084c1045c3d1ee3d99533e">m_frameNumber</a> / <a class="code" href="class_sequence_processor.html#be6adf35061cbd92d072ce0cb546820c">m_frameRate</a>));
<a name="l00265"></a>00265         CTime time = <a class="code" href="class_sequence_processor.html#5aa6b00e81cbf30a5845b5bd65ca6e73">m_startTime</a> + elapsed;
<a name="l00266"></a>00266         <a class="code" href="_globals_8cpp.html#ebac2e97267778257260308eed554ab2">drawText</a>(time.Format( <span class="stringliteral">"%a, %m/%d/%y, %I:%M:%S%p"</span>), 
<a name="l00267"></a>00267                 <a class="code" href="_globals_8cpp.html#8dbc3855d325a7c853bb8fd1607622e4">cvPoint</a>(<a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#e21c04f1c508fb2ae7ac1fc9c433d854">cameramodel</a>.<a class="code" href="class_camera_model.html#24fc2915f3b445ea9cf592480b03b631">w</a>-260, <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#e21c04f1c508fb2ae7ac1fc9c433d854">cameramodel</a>.<a class="code" href="class_camera_model.html#d561ff14d4687d142757026dc0a4ff9a">h</a>-20), frame, CV_RGB(0,0,128), CV_RGB(0,0,0), (float)1.1);
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00270"></a><a class="code" href="class_tracker_model.html#960622779b499dc733232b9447553241">00270</a> DateTime <a class="code" href="class_tracker_model.html#960622779b499dc733232b9447553241">TrackerModel::GetDateTime</a>(<span class="keywordtype">int</span> nFrame) {
<a name="l00271"></a>00271         DateTime time(<a class="code" href="class_sequence_processor.html#5aa6b00e81cbf30a5845b5bd65ca6e73">m_startTime</a>.GetYear(), <a class="code" href="class_sequence_processor.html#5aa6b00e81cbf30a5845b5bd65ca6e73">m_startTime</a>.GetMonth(), <a class="code" href="class_sequence_processor.html#5aa6b00e81cbf30a5845b5bd65ca6e73">m_startTime</a>.GetDay(), <a class="code" href="class_sequence_processor.html#5aa6b00e81cbf30a5845b5bd65ca6e73">m_startTime</a>.GetHour(), <a class="code" href="class_sequence_processor.html#5aa6b00e81cbf30a5845b5bd65ca6e73">m_startTime</a>.GetMinute(), <a class="code" href="class_sequence_processor.html#5aa6b00e81cbf30a5845b5bd65ca6e73">m_startTime</a>.GetSecond());
<a name="l00272"></a>00272         time = time.AddSeconds(1.0*nFrame/<a class="code" href="class_sequence_processor.html#be6adf35061cbd92d072ce0cb546820c">m_frameRate</a>);
<a name="l00273"></a>00273         <span class="keywordflow">return</span> time;
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00276"></a><a class="code" href="class_tracker_model.html#fe112f72fdada0b6751b6b4ce7298f90">00276</a> TimeSpan <a class="code" href="class_tracker_model.html#fe112f72fdada0b6751b6b4ce7298f90">TrackerModel::GetTimeSpan</a>(<span class="keywordtype">int</span> nFrames) {
<a name="l00277"></a>00277         TimeSpan span(0, 0, (<span class="keywordtype">int</span>)(nFrames/<a class="code" href="class_sequence_processor.html#be6adf35061cbd92d072ce0cb546820c">m_frameRate</a>));
<a name="l00278"></a>00278         <span class="keywordflow">return</span> span;
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00281"></a><a class="code" href="class_tracker_model.html#3a4c652cd62b7c73df9f8bda65536075">00281</a> <span class="keywordtype">int</span>  <a class="code" href="class_tracker_model.html#3a4c652cd62b7c73df9f8bda65536075">TrackerModel::Seconds2Frames</a>(<span class="keywordtype">double</span> sec) {
<a name="l00282"></a>00282         <span class="keywordflow">return</span> <a class="code" href="_globals_8cpp.html#1c469f80dc66c5c924c90a1e0913af2f">round</a>(sec*<a class="code" href="class_sequence_processor.html#be6adf35061cbd92d072ce0cb546820c">m_frameRate</a>);
<a name="l00283"></a>00283 };
<a name="l00284"></a>00284 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00285"></a><a class="code" href="class_tracker_model.html#7ff5b953f23680d83668c4d3dd000c33">00285</a> <span class="keywordtype">double</span> <a class="code" href="class_tracker_model.html#7ff5b953f23680d83668c4d3dd000c33">TrackerModel::Frames2Seconds</a>(<span class="keywordtype">int</span> f) {
<a name="l00286"></a>00286         <span class="keywordflow">return</span> 1.0*f/<a class="code" href="class_sequence_processor.html#be6adf35061cbd92d072ce0cb546820c">m_frameRate</a>;
<a name="l00287"></a>00287 };
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Apr 24 22:32:51 2007 for New Vision by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>New Vision: F:/My Documents/Visual Studio 2005/Projects/NewVision/NewVision/CameraDialog.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>F:/My Documents/Visual Studio 2005/Projects/NewVision/NewVision/CameraDialog.cpp</h1><a href="_camera_dialog_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// CameraDialog.cpp : implementation file</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include "<a class="code" href="_std_afx_8h.html">stdafx.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include "<a class="code" href="_new_vision_doc_8h.html">NewVisionDoc.h</a>"</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include "<a class="code" href="_camera_dialog_8h.html">CameraDialog.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include "<a class="code" href="_globals_8h.html">Globals.h</a>"</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="_camera_dialog_8h.html">CameraDialog.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">#using &lt;mscorlib.dll&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#using &lt;System.dll&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="keyword">using namespace </span>System;
<a name="l00010"></a>00010 <span class="keyword">using namespace </span>System::Diagnostics;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment">// CameraDialog dialog</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 BEGIN_MESSAGE_MAP(<a class="code" href="class_camera_dialog.html">CameraDialog</a>, CPropertyPage)
<a name="l00015"></a>00015         ON_BN_CLICKED(<a class="code" href="resource_8h.html#e1ed0560c8dc3f6911490dd2a26042ab">IDC_BUTTONRESET</a>, OnBnClickedButtonReset)
<a name="l00016"></a>00016         ON_BN_CLICKED(<a class="code" href="resource_8h.html#7a2a110a1469f002ede53c98e01f629d">IDC_BUTTONADD</a>, OnBnClickedButtonAdd)
<a name="l00017"></a>00017         ON_BN_CLICKED(<a class="code" href="resource_8h.html#7457cfa66d062d723658eed5524bb422">IDC_BUTTONDELETE</a>, OnBnClickedButtonDelete)
<a name="l00018"></a>00018         ON_BN_CLICKED(<a class="code" href="resource_8h.html#293ff6cb8fe36e4f2ae5f34076ffe1f3">IDC_BUTTONDELETEALL</a>, OnBnClickedButtonDeleteAll)
<a name="l00019"></a>00019         ON_WM_MOUSEMOVE()
<a name="l00020"></a>00020         ON_WM_HSCROLL()
<a name="l00021"></a>00021         ON_WM_VSCROLL()
<a name="l00022"></a>00022         ON_BN_CLICKED(<a class="code" href="resource_8h.html#6d1a82aff692ecb64431a2fac7813435">IDC_CAMERA_MONO</a>, OnBnClickedCameraMono)
<a name="l00023"></a>00023         ON_BN_CLICKED(<a class="code" href="resource_8h.html#0072a6bd78c765529748dde0c2260755">IDC_CAMERA_PANO</a>, OnBnClickedCameraPano)
<a name="l00024"></a>00024 END_MESSAGE_MAP()
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 BEGIN_MESSAGE_MAP(<a class="code" href="class_c_calibrate_control.html">CCalibrateControl</a>, CButton)
<a name="l00027"></a>00027         ON_WM_MOUSEMOVE()
<a name="l00028"></a>00028 END_MESSAGE_MAP()
<a name="l00029"></a>00029 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00030"></a><a class="code" href="class_camera_dialog.html#3c33ea34693adaba0ba343c993dd3100">00030</a> <a class="code" href="class_camera_dialog.html">CameraDialog</a>::<a class="code" href="class_camera_dialog.html">CameraDialog</a>(CWnd* pParent <span class="comment">/* = NULL */</span>)
<a name="l00031"></a>00031         : CPropertyPage(<a class="code" href="class_camera_dialog.html">CameraDialog</a>::IDD), m_image()
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00035"></a><a class="code" href="class_camera_dialog.html#3849f0ff21062591bb8e00a54ffefe76">00035</a> <a class="code" href="class_camera_dialog.html#3849f0ff21062591bb8e00a54ffefe76">CameraDialog::~CameraDialog</a>()
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00039"></a><a class="code" href="class_camera_dialog.html#13a855702f51ae1277b152ac579fb622">00039</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#13a855702f51ae1277b152ac579fb622">CameraDialog::DoDataExchange</a>(CDataExchange* pDX)
<a name="l00040"></a>00040 {
<a name="l00041"></a>00041         CPropertyPage::DoDataExchange(pDX);
<a name="l00042"></a>00042         DDX_Control(pDX, <a class="code" href="resource_8h.html#0baef53a29ebd5b3092f075141af63a6">IDC_IMAGE</a>, <a class="code" href="class_camera_dialog.html#68c035f44023413dc8cf738dc5236608">m_image</a>);
<a name="l00043"></a>00043         DDX_Control(pDX, <a class="code" href="resource_8h.html#dc31a067525638f2de67f236e8ba60b2">IDC_HEIGHTS</a>, <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>);
<a name="l00044"></a>00044         DDX_Control(pDX, <a class="code" href="resource_8h.html#1b82d9acdc7b8c3d74a125c930be71bd">IDC_CURRENTHEIGHT</a>, <a class="code" href="class_camera_dialog.html#38fc17f015fab54ce6b8bdd0865cf822">m_currentHeight</a>);
<a name="l00045"></a>00045         DDX_Control(pDX, <a class="code" href="resource_8h.html#469717f52aff309757f0c748bd9f570a">IDC_CAMERA_SCROLLBAR1</a>, <a class="code" href="class_camera_dialog.html#dc29a20cf419ade9d3f78955f31be36e">m_vbar</a>);
<a name="l00046"></a>00046         DDX_Control(pDX, <a class="code" href="resource_8h.html#e9e07dffbe91a3eed207ec121781ec74">IDC_CAMERA_SCROLLBAR2</a>, <a class="code" href="class_camera_dialog.html#c8d19918bf1acb7187929f0db5ad11e5">m_hbar</a>);
<a name="l00047"></a>00047         DDX_Text(pDX, <a class="code" href="resource_8h.html#8003367c62fc163ce464fe0e37c7c07d">IDC_ELEVATION</a>, <a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a>);
<a name="l00048"></a>00048         DDX_Radio(pDX, <a class="code" href="resource_8h.html#6d1a82aff692ecb64431a2fac7813435">IDC_CAMERA_MONO</a>, <a class="code" href="class_camera_model.html#4f880809688deb332b8f28ee9074fc58">m_cameraType</a>);
<a name="l00049"></a>00049         <a class="code" href="class_camera_dialog.html#a72ea1e2d1a50b963ecd05fdab30889a">UpdateControls</a>();
<a name="l00050"></a>00050         <a class="code" href="class_camera_dialog.html#b45beea3f15be74bbfd5e613d03ef24c">Initialize</a>();
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00053"></a><a class="code" href="class_camera_dialog.html#a72ea1e2d1a50b963ecd05fdab30889a">00053</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#a72ea1e2d1a50b963ecd05fdab30889a">CameraDialog::UpdateControls</a>() {
<a name="l00054"></a>00054         <span class="keywordflow">switch</span> (<a class="code" href="class_camera_model.html#4f880809688deb332b8f28ee9074fc58">m_cameraType</a>) {
<a name="l00055"></a>00055                 <span class="keywordflow">case</span> <a class="code" href="_camera_model_8h.html#e27786af5883fda851579f95897d5b80295dc00dd5da0bca4ed9f724c3cb3904">PROJECTION</a>:
<a name="l00056"></a>00056                         GetDlgItem(<a class="code" href="resource_8h.html#62cedae02f3076f30d9a6bb0ed8d3e43">IDC_STATIC3</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00057"></a>00057                         GetDlgItem(<a class="code" href="resource_8h.html#bae2ca2b8b9ffac5fb6be3016563f037">IDC_STATIC4</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00058"></a>00058                         GetDlgItem(<a class="code" href="resource_8h.html#8003367c62fc163ce464fe0e37c7c07d">IDC_ELEVATION</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00059"></a>00059                         GetDlgItem(<a class="code" href="resource_8h.html#37f587596b464239581b844e04dda1da">IDC_STATIC1</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00060"></a>00060                         GetDlgItem(<a class="code" href="resource_8h.html#7a2a110a1469f002ede53c98e01f629d">IDC_BUTTONADD</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00061"></a>00061                         GetDlgItem(<a class="code" href="resource_8h.html#7457cfa66d062d723658eed5524bb422">IDC_BUTTONDELETE</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00062"></a>00062                         GetDlgItem(<a class="code" href="resource_8h.html#0baef53a29ebd5b3092f075141af63a6">IDC_IMAGE</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00063"></a>00063                         GetDlgItem(<a class="code" href="resource_8h.html#dc31a067525638f2de67f236e8ba60b2">IDC_HEIGHTS</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00064"></a>00064                         GetDlgItem(<a class="code" href="resource_8h.html#1b82d9acdc7b8c3d74a125c930be71bd">IDC_CURRENTHEIGHT</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00065"></a>00065                         GetDlgItem(<a class="code" href="resource_8h.html#469717f52aff309757f0c748bd9f570a">IDC_CAMERA_SCROLLBAR1</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00066"></a>00066                         GetDlgItem(<a class="code" href="resource_8h.html#e9e07dffbe91a3eed207ec121781ec74">IDC_CAMERA_SCROLLBAR2</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00067"></a>00067                         <span class="keywordflow">break</span>;
<a name="l00068"></a>00068                 <span class="keywordflow">case</span> <a class="code" href="_camera_model_8h.html#e27786af5883fda851579f95897d5b80e5031a2dca66aec4c071e90aa6bee1ff">SPHERICAL</a>:
<a name="l00069"></a>00069                         GetDlgItem(<a class="code" href="resource_8h.html#37f587596b464239581b844e04dda1da">IDC_STATIC1</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00070"></a>00070                         GetDlgItem(<a class="code" href="resource_8h.html#7a2a110a1469f002ede53c98e01f629d">IDC_BUTTONADD</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00071"></a>00071                         GetDlgItem(<a class="code" href="resource_8h.html#7457cfa66d062d723658eed5524bb422">IDC_BUTTONDELETE</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00072"></a>00072                         GetDlgItem(<a class="code" href="resource_8h.html#0baef53a29ebd5b3092f075141af63a6">IDC_IMAGE</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00073"></a>00073                         GetDlgItem(<a class="code" href="resource_8h.html#dc31a067525638f2de67f236e8ba60b2">IDC_HEIGHTS</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00074"></a>00074                         GetDlgItem(<a class="code" href="resource_8h.html#1b82d9acdc7b8c3d74a125c930be71bd">IDC_CURRENTHEIGHT</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00075"></a>00075                         GetDlgItem(<a class="code" href="resource_8h.html#469717f52aff309757f0c748bd9f570a">IDC_CAMERA_SCROLLBAR1</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00076"></a>00076                         GetDlgItem(<a class="code" href="resource_8h.html#e9e07dffbe91a3eed207ec121781ec74">IDC_CAMERA_SCROLLBAR2</a>)-&gt;ShowWindow(SW_HIDE);
<a name="l00077"></a>00077                         GetDlgItem(IDC_STATIC3)-&gt;ShowWindow(SW_SHOW);
<a name="l00078"></a>00078                         GetDlgItem(<a class="code" href="resource_8h.html#bae2ca2b8b9ffac5fb6be3016563f037">IDC_STATIC4</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00079"></a>00079                         GetDlgItem(<a class="code" href="resource_8h.html#8003367c62fc163ce464fe0e37c7c07d">IDC_ELEVATION</a>)-&gt;ShowWindow(SW_SHOW);
<a name="l00080"></a>00080         };
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00084"></a><a class="code" href="class_camera_dialog.html#8aaf2fdf9346b83eafef75044b8d035f">00084</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#8aaf2fdf9346b83eafef75044b8d035f">CameraDialog::OnBnClickedCameraMono</a>()
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086         UpdateData();
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00089"></a><a class="code" href="class_camera_dialog.html#e4f4cda8764543632c647cde9983d126">00089</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#e4f4cda8764543632c647cde9983d126">CameraDialog::OnBnClickedCameraPano</a>()
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091         UpdateData();
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00094"></a><a class="code" href="class_camera_dialog.html#5e1448064e3b5f516b66c717a870bff1">00094</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#5e1448064e3b5f516b66c717a870bff1">CameraDialog::Serialize</a>( CArchive&amp; ar )
<a name="l00095"></a>00095  {
<a name="l00096"></a>00096         <a class="code" href="class_camera_model.html#d0acb6ee9f49a0ea3b32fdb74d109053">CameraModel::Serialize</a>(ar);
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00099"></a><a class="code" href="class_camera_dialog.html#959bfde45f69ab0e6fece945e749a816">00099</a> BOOL <a class="code" href="class_camera_dialog.html#959bfde45f69ab0e6fece945e749a816">CameraDialog::OnSetActive</a>() {
<a name="l00100"></a>00100         CPropertyPage::OnSetActive();
<a name="l00101"></a>00101         <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>.<a class="code" href="class_c_number_list_box.html#7ae6048e3be31530f4a646c6fd4e1a15">UpdateData</a>(<span class="keyword">false</span>);
<a name="l00102"></a>00102         <span class="keywordflow">switch</span> (<a class="code" href="class_camera_model.html#4f880809688deb332b8f28ee9074fc58">m_cameraType</a>) {
<a name="l00103"></a>00103                 <span class="keywordflow">case</span> <a class="code" href="_camera_model_8h.html#e27786af5883fda851579f95897d5b80295dc00dd5da0bca4ed9f724c3cb3904">PROJECTION</a>: <span class="keywordflow">return</span> <a class="code" href="class_camera_dialog.html#68c035f44023413dc8cf738dc5236608">m_image</a>.<a class="code" href="class_c_calibrate_control.html#c1df77f586b74eec9a1a2c1715b4fe8d">Initialize</a>(<a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>); 
<a name="l00104"></a>00104                 <span class="keywordflow">case</span> <a class="code" href="_camera_model_8h.html#e27786af5883fda851579f95897d5b80e5031a2dca66aec4c071e90aa6bee1ff">SPHERICAL</a>: <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00109"></a><a class="code" href="class_camera_dialog.html#b45beea3f15be74bbfd5e613d03ef24c">00109</a> <span class="keywordtype">bool</span> <a class="code" href="class_camera_dialog.html#b45beea3f15be74bbfd5e613d03ef24c">CameraDialog::Initialize</a>() {
<a name="l00110"></a>00110         <a class="code" href="class_camera_model.html#24fc2915f3b445ea9cf592480b03b631">w</a> = <a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>-&gt;width; <a class="code" href="class_camera_model.html#d561ff14d4687d142757026dc0a4ff9a">h</a> = <a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>-&gt;height;
<a name="l00111"></a>00111         <span class="keywordflow">switch</span> (<a class="code" href="class_camera_model.html#4f880809688deb332b8f28ee9074fc58">m_cameraType</a>) {
<a name="l00112"></a>00112                 <span class="keywordflow">case</span> <a class="code" href="_camera_model_8h.html#e27786af5883fda851579f95897d5b80295dc00dd5da0bca4ed9f724c3cb3904">PROJECTION</a>: {
<a name="l00113"></a>00113                         <span class="comment">// see Cipolla, R and Drummond, Tom and Robertson, D</span>
<a name="l00114"></a>00114                         <span class="comment">// "Camera Calibration from Vanishing Points in Images of Architectural Scenes"</span>
<a name="l00115"></a>00115                         <span class="keywordflow">if</span> (!<a class="code" href="class_camera_dialog.html#68c035f44023413dc8cf738dc5236608">m_image</a>.<a class="code" href="class_c_calibrate_control.html#c1df77f586b74eec9a1a2c1715b4fe8d">Initialize</a>(<a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>))
<a name="l00116"></a>00116                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118                         <span class="comment">// check if there are enough reference heights</span>
<a name="l00119"></a>00119                         <span class="keywordflow">if</span> (<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>.GetCount() != <a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.GetCount())
<a name="l00120"></a>00120                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;   
<a name="l00121"></a>00121 
<a name="l00122"></a>00122                         <span class="comment">// check if there are enough lines for calibration</span>
<a name="l00123"></a>00123                         <span class="keywordflow">if</span> (<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>.GetCount() &lt; 2 || <a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>.GetCount() &lt; 2 
<a name="l00124"></a>00124                                 || <a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>.GetCount() &lt; 2 || <a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.GetCount() &lt; 1)
<a name="l00125"></a>00125                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127                         <span class="comment">// Compute vanishing points </span>
<a name="l00128"></a>00128                         <span class="comment">// Important!!! Calibration lines for VX, VY, VZ must be aiming toward the vanishing points, not away from them!!!</span>
<a name="l00129"></a>00129                         <a class="code" href="class_camera_dialog.html#2e3368a4a3c56d45db38eed20ae4d48a">FindVanishingPoint</a>(<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>, <a class="code" href="class_camera_model.html#0cf603db0c3ffde14a382a406984c614">VX</a>, <a class="code" href="class_camera_model.html#24fc2915f3b445ea9cf592480b03b631">w</a>, <a class="code" href="class_camera_model.html#d561ff14d4687d142757026dc0a4ff9a">h</a>);
<a name="l00130"></a>00130                         <a class="code" href="class_camera_dialog.html#2e3368a4a3c56d45db38eed20ae4d48a">FindVanishingPoint</a>(<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>, <a class="code" href="class_camera_model.html#98015c3069e12b5c71ccbc63a4ab0ea7">VY</a>, <a class="code" href="class_camera_model.html#24fc2915f3b445ea9cf592480b03b631">w</a>, <a class="code" href="class_camera_model.html#d561ff14d4687d142757026dc0a4ff9a">h</a>);
<a name="l00131"></a>00131                         <a class="code" href="class_camera_dialog.html#2e3368a4a3c56d45db38eed20ae4d48a">FindVanishingPoint</a>(<a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>, <a class="code" href="class_camera_model.html#e84288c553968b8906c6d861eed797b8">VZ</a>, <a class="code" href="class_camera_model.html#24fc2915f3b445ea9cf592480b03b631">w</a>, <a class="code" href="class_camera_model.html#d561ff14d4687d142757026dc0a4ff9a">h</a>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 0, 0, cvmGet(<a class="code" href="class_camera_model.html#0cf603db0c3ffde14a382a406984c614">VX</a>, 0, 0)); 
<a name="l00134"></a>00134                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 1, 0, cvmGet(<a class="code" href="class_camera_model.html#0cf603db0c3ffde14a382a406984c614">VX</a>, 1, 0)); 
<a name="l00135"></a>00135                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 2, 0, cvmGet(<a class="code" href="class_camera_model.html#0cf603db0c3ffde14a382a406984c614">VX</a>, 2, 0)); 
<a name="l00136"></a>00136                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 0, 1, cvmGet(<a class="code" href="class_camera_model.html#98015c3069e12b5c71ccbc63a4ab0ea7">VY</a>, 0, 0)); 
<a name="l00137"></a>00137                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 1, 1, cvmGet(<a class="code" href="class_camera_model.html#98015c3069e12b5c71ccbc63a4ab0ea7">VY</a>, 1, 0)); 
<a name="l00138"></a>00138                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 2, 1, cvmGet(<a class="code" href="class_camera_model.html#98015c3069e12b5c71ccbc63a4ab0ea7">VY</a>, 2, 0)); 
<a name="l00139"></a>00139                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 0, 2, cvmGet(<a class="code" href="class_camera_model.html#e84288c553968b8906c6d861eed797b8">VZ</a>, 0, 0)); 
<a name="l00140"></a>00140                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 1, 2, cvmGet(<a class="code" href="class_camera_model.html#e84288c553968b8906c6d861eed797b8">VZ</a>, 1, 0)); 
<a name="l00141"></a>00141                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 2, 2, cvmGet(<a class="code" href="class_camera_model.html#e84288c553968b8906c6d861eed797b8">VZ</a>, 2, 0)); 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143                         <span class="comment">// Find camera elevation</span>
<a name="l00144"></a>00144                         CvMat *top, *bot;
<a name="l00145"></a>00145                         <span class="comment">// Find h using height samples: assume p14 = -h*p13; p34 = -h*p33; p34 = -h*p33</span>
<a name="l00146"></a>00146                         <span class="comment">// sbot*(x1, y1, 1)=P*(X, Y, Zbot, 1) </span>
<a name="l00147"></a>00147                         <span class="comment">// stop*(x2, y2, 1)=P*(X, Y, Ztop, 1) </span>
<a name="l00148"></a>00148                         <span class="comment">// UNKNOWNS: X, Y, Zbot, Ztop, sbot, stop, h (aka. m_elevation)</span>
<a name="l00149"></a>00149                         <a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a> = 0;
<a name="l00150"></a>00150                         CvMat* A = cvCreateMat(7, 7, CV_64FC1); 
<a name="l00151"></a>00151                         CvMat* B = cvCreateMat(7, 1, CV_64FC1); 
<a name="l00152"></a>00152                         CvMat* x = cvCreateMat(7, 1, CV_64FC1); 
<a name="l00153"></a>00153                         bot = cvCreateMat(3, 1, CV_64FC1); 
<a name="l00154"></a>00154                         top = cvCreateMat(3, 1, CV_64FC1); 
<a name="l00155"></a>00155                         cvZero(B);
<a name="l00156"></a>00156                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0;n&lt;<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.GetCount();n++) {
<a name="l00157"></a>00157                                 <a class="code" href="class_camera_model.html#068f0782e81c40eeaf18052f41e6c947">coordsImage2Homo</a>(cvPointTo32f(<a class="code" href="_globals_8cpp.html#8dbc3855d325a7c853bb8fd1607622e4">cvPoint</a>(<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>[n].p1)), bot);
<a name="l00158"></a>00158                                 <a class="code" href="class_camera_model.html#068f0782e81c40eeaf18052f41e6c947">coordsImage2Homo</a>(cvPointTo32f(<a class="code" href="_globals_8cpp.html#8dbc3855d325a7c853bb8fd1607622e4">cvPoint</a>(<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>[n].p2)), top);
<a name="l00159"></a>00159                                 <span class="keywordtype">double</span> A_[] = {
<a name="l00160"></a>00160                                         cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,0), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,1), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,2),             0, -cvmGet(bot, 0, 0),                  0, -cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,2),
<a name="l00161"></a>00161                                         cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,0), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,1),             0, cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,2),                  0, -cvmGet(top, 0, 0), -cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,0,2),
<a name="l00162"></a>00162                                         cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,0), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,1), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,2),             0, -cvmGet(bot, 1, 0),                  0, -cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,2),
<a name="l00163"></a>00163                                         cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,0), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,1),             0, cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,2),                  0, -cvmGet(top, 1, 0), -cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,1,2),
<a name="l00164"></a>00164                                         cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,0), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,1), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,2),             0,                 -1,                  0, -cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,2),
<a name="l00165"></a>00165                                         cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,0), cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,1),             0, cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,2),                  0,                 -1, -cvmGet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>,2,2),
<a name="l00166"></a>00166                                                                 0,             0,            -1,             1,                  0,                  0, 0
<a name="l00167"></a>00167                                                         };
<a name="l00168"></a>00168                                 memcpy(A-&gt;data.db, A_, <span class="keyword">sizeof</span>(A_));
<a name="l00169"></a>00169                                 cvSetReal2D(B, 6, 0, <a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>[n]);
<a name="l00170"></a>00170                                 cvSolve(A, B, x, CV_SVD);
<a name="l00171"></a>00171                                 <a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a> += (double)(cvGetReal2D(x,6,0));
<a name="l00172"></a>00172                         }
<a name="l00173"></a>00173                         <a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a> /= <a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.GetCount();
<a name="l00174"></a>00174                         cvReleaseMat(&amp;A); cvReleaseMat(&amp;B); cvReleaseMat(&amp;x); cvReleaseMat(&amp;bot); cvReleaseMat(&amp;top);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                         <span class="comment">// Set translation from world to camera coordinates</span>
<a name="l00177"></a>00177                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 0, 3, -<a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a>*cvmGet(<a class="code" href="class_camera_model.html#e84288c553968b8906c6d861eed797b8">VZ</a>, 0, 0)); 
<a name="l00178"></a>00178                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 1, 3, -<a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a>*cvmGet(VZ, 1, 0)); 
<a name="l00179"></a>00179                         cvmSet(<a class="code" href="class_camera_model.html#39ca891882ad9c67492debf579016b08">P</a>, 2, 3, -<a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a>*cvmGet(VZ, 2, 0)); 
<a name="l00180"></a>00180                         <span class="keywordflow">break</span>;
<a name="l00181"></a>00181                 }
<a name="l00182"></a>00182                 <span class="keywordflow">case</span> <a class="code" href="_camera_model_8h.html#e27786af5883fda851579f95897d5b80e5031a2dca66aec4c071e90aa6bee1ff">SPHERICAL</a>: {
<a name="l00183"></a>00183 
<a name="l00184"></a>00184                 }
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="comment">// initialize distance_mask and m_minBodyDistance, m_maxBodyDistance</span>
<a name="l00188"></a>00188         <span class="comment">// TEMP: the largest distance</span>
<a name="l00189"></a>00189         <span class="keywordtype">double</span> LARGE_DIST = 3000;
<a name="l00190"></a>00190         <a class="code" href="class_camera_model.html#d34fbb702d70e98d712320c633050aef">m_minBodyDistance</a> = INT_MAX;
<a name="l00191"></a>00191         <a class="code" href="class_camera_model.html#81aef6ceb51e526280f83dda5fa3ca30">m_maxBodyDistance</a> = 0;
<a name="l00192"></a>00192         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>=0;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>&lt;<a class="code" href="class_camera_model.html#24fc2915f3b445ea9cf592480b03b631">w</a>;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>++) {
<a name="l00193"></a>00193                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>=0;<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>&lt;<a class="code" href="class_camera_model.html#d561ff14d4687d142757026dc0a4ff9a">h</a>;<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>++) {
<a name="l00194"></a>00194                         <span class="keywordtype">double</span> dist = <a class="code" href="class_camera_model.html#8f4a17132acb2e840159bde56a8d27a7">coordsDistanceFromCamera</a>(<a class="code" href="class_camera_model.html#26943cb85699af14deb4e9867aecbf43">coordsImage2Real</a>(<a class="code" href="_globals_8cpp.html#1a9e4f0ff8116bb44834c09503846811">cvPoint2D32f</a>(<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>, <a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>), <a class="code" href="class_model.html#a0b1e435ecf4aaa93341250242dce611">doc</a>-&gt;<a class="code" href="class_c_new_vision_doc.html#c05200bcc948d3bc2e39fd0532595117">bodymodel</a>.<a class="code" href="class_body_model.html#708f4dfdbd4a4312c25ba50139e14519">m_heightM</a>/2));
<a name="l00195"></a>00195                         dist = min(dist, LARGE_DIST);
<a name="l00196"></a>00196                         ((<span class="keywordtype">float</span>*)(<a class="code" href="_globals_8cpp.html#0c575e5a96aee255ada87d30446af873">distance_mask</a>-&gt;imageData + <a class="code" href="_globals_8cpp.html#0c575e5a96aee255ada87d30446af873">distance_mask</a>-&gt;widthStep*<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>))[<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>] = (<span class="keywordtype">float</span>)dist;
<a name="l00197"></a>00197                         <a class="code" href="class_camera_model.html#81aef6ceb51e526280f83dda5fa3ca30">m_maxBodyDistance</a> = max(<a class="code" href="class_camera_model.html#81aef6ceb51e526280f83dda5fa3ca30">m_maxBodyDistance</a>, dist);
<a name="l00198"></a>00198                         <a class="code" href="class_camera_model.html#d34fbb702d70e98d712320c633050aef">m_minBodyDistance</a> = min(<a class="code" href="class_camera_model.html#d34fbb702d70e98d712320c633050aef">m_minBodyDistance</a>, dist);
<a name="l00199"></a>00199                 }
<a name="l00200"></a>00200         }
<a name="l00201"></a>00201         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00204"></a><a class="code" href="class_camera_dialog.html#f092b645ae76491e0c4682bbff475e17">00204</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#f092b645ae76491e0c4682bbff475e17">CameraDialog::DeInitialize</a>() {
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (m_hWnd &amp;&amp; <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>) 
<a name="l00206"></a>00206                 <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>.<a class="code" href="class_c_number_list_box.html#4be6b05fcf7c74a83f16395901b578f1">Clear</a>();
<a name="l00207"></a>00207         <a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>.RemoveAll();
<a name="l00208"></a>00208         <a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>.RemoveAll();
<a name="l00209"></a>00209         <a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>.RemoveAll();
<a name="l00210"></a>00210         <a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.RemoveAll();
<a name="l00211"></a>00211         <a class="code" href="class_camera_model.html#24fc2915f3b445ea9cf592480b03b631">w</a> = 320; <a class="code" href="class_camera_model.html#d561ff14d4687d142757026dc0a4ff9a">h</a> = 240;
<a name="l00212"></a>00212         <a class="code" href="class_camera_model.html#4f880809688deb332b8f28ee9074fc58">m_cameraType</a> = <a class="code" href="_camera_model_8h.html#e27786af5883fda851579f95897d5b80295dc00dd5da0bca4ed9f724c3cb3904">PROJECTION</a>;
<a name="l00213"></a>00213         <a class="code" href="class_camera_model.html#b705a6931016b796b5b45ebca5a1874a">m_elevation</a> = 350;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00216"></a><a class="code" href="class_camera_dialog.html#2e3368a4a3c56d45db38eed20ae4d48a">00216</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#2e3368a4a3c56d45db38eed20ae4d48a">CameraDialog::FindVanishingPoint</a>(<a class="code" href="class_c_array.html">CArray&lt;CLine&gt;</a>&amp; x, CvMat* v, <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h) {
<a name="l00217"></a>00217         CvMat* M = cvCreateMat(3, 3, CV_64FC1);
<a name="l00218"></a>00218         cvZero(M);
<a name="l00219"></a>00219         CvMat* EVALS = cvCreateMat(3, 1, CV_64FC1); 
<a name="l00220"></a>00220         CvMat* EVECS = cvCreateMat(3, 3, CV_64FC1); 
<a name="l00221"></a>00221         CvMat* e1 = cvCreateMat(3, 1, CV_64FC1); 
<a name="l00222"></a>00222         CvMat* e2 = cvCreateMat(3, 1, CV_64FC1);
<a name="l00223"></a>00223         CvMat* line = cvCreateMat(3, 1, CV_64FC1);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>.GetCount();i++) {
<a name="l00226"></a>00226                 <a class="code" href="class_camera_model.html#068f0782e81c40eeaf18052f41e6c947">coordsImage2Homo</a>(cvPointTo32f(<a class="code" href="_globals_8cpp.html#8dbc3855d325a7c853bb8fd1607622e4">cvPoint</a>(<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>[i].p1)), e1);
<a name="l00227"></a>00227                 <a class="code" href="class_camera_model.html#068f0782e81c40eeaf18052f41e6c947">coordsImage2Homo</a>(cvPointTo32f(<a class="code" href="_globals_8cpp.html#8dbc3855d325a7c853bb8fd1607622e4">cvPoint</a>(<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>[i].p2)), e2);
<a name="l00228"></a>00228                 cvCrossProduct(e1, e2, line);
<a name="l00229"></a>00229                 <span class="comment">// fill bottom left triangle of M</span>
<a name="l00230"></a>00230                 <span class="keywordtype">double</span> a = cvGetReal1D(line, 0), b = cvGetReal1D(line, 1), c = cvGetReal1D(line, 2);
<a name="l00231"></a>00231                 cvSetReal2D(M, 0, 0, a*a+cvGetReal2D(M,0,0));
<a name="l00232"></a>00232                 cvSetReal2D(M, 0, 1, a*b+cvGetReal2D(M,0,1));
<a name="l00233"></a>00233                 cvSetReal2D(M, 0, 2, a*c+cvGetReal2D(M,0,2));
<a name="l00234"></a>00234                 cvSetReal2D(M, 1, 1, b*b+cvGetReal2D(M,1,1));
<a name="l00235"></a>00235                 cvSetReal2D(M, 1, 2, b*c+cvGetReal2D(M,1,2));
<a name="l00236"></a>00236                 cvSetReal2D(M, 2, 2, c*c+cvGetReal2D(M,2,2));
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239         <span class="comment">// fill the top right triangle of M symmetrically</span>
<a name="l00240"></a>00240         cvSetReal2D(M, 1, 0, cvGetReal2D(M,0,1));
<a name="l00241"></a>00241         cvSetReal2D(M, 2, 0, cvGetReal2D(M,0,2));
<a name="l00242"></a>00242         cvSetReal2D(M, 2, 1, cvGetReal2D(M,1,2));
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <span class="comment">// find eigen vector that corresponds to the smallest eigen value</span>
<a name="l00245"></a>00245         cvSVD(M, EVALS, EVECS, 0, CV_SVD_MODIFY_A);
<a name="l00246"></a>00246         <span class="keywordtype">double</span> a[3]= {cvGetReal2D(EVECS,0,2), cvGetReal2D(EVECS,1,2), cvGetReal2D(EVECS,2,2)};
<a name="l00247"></a>00247         cvReleaseMat(&amp;M);
<a name="l00248"></a>00248         cvReleaseMat(&amp;EVALS);
<a name="l00249"></a>00249         cvReleaseMat(&amp;EVECS);
<a name="l00250"></a>00250         cvReleaseMat(&amp;e1);
<a name="l00251"></a>00251         cvReleaseMat(&amp;e2);
<a name="l00252"></a>00252         cvReleaseMat(&amp;line);
<a name="l00253"></a>00253         cvSetReal1D( v, 0, a[0]);cvSetReal1D( v, 1, a[1]);cvSetReal1D( v, 2, a[2]);
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00256"></a><a class="code" href="class_camera_dialog.html#7dd3ca717931f294d982e73c20c31931">00256</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#7dd3ca717931f294d982e73c20c31931">CameraDialog::OnBnClickedButtonAdd</a>()
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258         <span class="keywordtype">char</span> s[10];
<a name="l00259"></a>00259         <a class="code" href="class_camera_dialog.html#38fc17f015fab54ce6b8bdd0865cf822">m_currentHeight</a>.GetLine(0, s, 4);
<a name="l00260"></a>00260         <span class="keywordflow">if</span> (atoi(s)) {
<a name="l00261"></a>00261                 <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>.<a class="code" href="class_c_number_list_box.html#2f997f97e5dd09d9c38b6e954dc309b7">Add</a>(atoi(s));
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263         <span class="keywordflow">else</span> 
<a name="l00264"></a>00264                 AfxMessageBox(<span class="stringliteral">"Please enter a numeric value!"</span>, MB_ICONINFORMATION | MB_OK);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         <a class="code" href="class_camera_dialog.html#38fc17f015fab54ce6b8bdd0865cf822">m_currentHeight</a>.SetSel(0,-1); <a class="code" href="class_camera_dialog.html#38fc17f015fab54ce6b8bdd0865cf822">m_currentHeight</a>.Clear();
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00269"></a><a class="code" href="class_camera_dialog.html#b0eafa78718f07f77e61a40865c00944">00269</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#b0eafa78718f07f77e61a40865c00944">CameraDialog::OnBnClickedButtonDeleteAll</a>()
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271         <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>.<a class="code" href="class_c_number_list_box.html#4be6b05fcf7c74a83f16395901b578f1">Clear</a>();
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00274"></a><a class="code" href="class_camera_dialog.html#424c43be8c6f158e1cd3baf595cee327">00274</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#424c43be8c6f158e1cd3baf595cee327">CameraDialog::OnBnClickedButtonDelete</a>()
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276         <span class="keywordflow">if</span> (<a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>.GetCurSel() != LB_ERR)
<a name="l00277"></a>00277                 <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>.<a class="code" href="class_c_number_list_box.html#50b3f71ad4cd5863bcf184955cdf778d">RemoveCurrent</a>();
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00280"></a><a class="code" href="class_camera_dialog.html#f2a7f198036e3c2e44445eb62eca4a5a">00280</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#f2a7f198036e3c2e44445eb62eca4a5a">CameraDialog::OnBnClickedButtonReset</a>()
<a name="l00281"></a>00281 {
<a name="l00282"></a>00282         <a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>.RemoveAll();
<a name="l00283"></a>00283         <a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>.RemoveAll();
<a name="l00284"></a>00284         <a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>.RemoveAll();
<a name="l00285"></a>00285         <a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.RemoveAll();
<a name="l00286"></a>00286         <a class="code" href="class_camera_dialog.html#9c656de3a053115bc69c4bd4978e3ec4">m_heights</a>.<a class="code" href="class_c_number_list_box.html#4be6b05fcf7c74a83f16395901b578f1">Clear</a>();
<a name="l00287"></a>00287         Invalidate();
<a name="l00288"></a>00288         UpdateWindow();
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00291"></a><a class="code" href="class_camera_dialog.html#006cfc7f5e4584a842b45b2476b77bdd">00291</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#006cfc7f5e4584a842b45b2476b77bdd">CameraDialog::OnVScroll</a>(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar) 
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293         <span class="keywordtype">int</span> curpos = pScrollBar-&gt;GetScrollPos();
<a name="l00294"></a>00294         <span class="keywordtype">int</span> minpos;
<a name="l00295"></a>00295         <span class="keywordtype">int</span> maxpos;
<a name="l00296"></a>00296         pScrollBar-&gt;GetScrollRange(&amp;minpos, &amp;maxpos);
<a name="l00297"></a>00297         SCROLLINFO   info;
<a name="l00298"></a>00298     pScrollBar-&gt;GetScrollInfo(&amp;info, SIF_ALL);
<a name="l00299"></a>00299         <span class="keywordflow">switch</span> (nSBCode)
<a name="l00300"></a>00300     {
<a name="l00301"></a>00301                 <span class="keywordflow">case</span> SB_TOP:      
<a name="l00302"></a>00302                         curpos = minpos;
<a name="l00303"></a>00303                         <span class="keywordflow">break</span>;
<a name="l00304"></a>00304                 <span class="keywordflow">case</span> SB_BOTTOM:     
<a name="l00305"></a>00305                         curpos = maxpos;
<a name="l00306"></a>00306                         <span class="keywordflow">break</span>;
<a name="l00307"></a>00307                 <span class="keywordflow">case</span> SB_ENDSCROLL: 
<a name="l00308"></a>00308                         <span class="keywordflow">break</span>;
<a name="l00309"></a>00309                 <span class="keywordflow">case</span> SB_LINEUP:      
<a name="l00310"></a>00310                         <span class="keywordflow">if</span> (curpos &gt; minpos)
<a name="l00311"></a>00311                                 curpos--;
<a name="l00312"></a>00312                         <span class="keywordflow">break</span>;
<a name="l00313"></a>00313                 <span class="keywordflow">case</span> SB_LINEDOWN:   
<a name="l00314"></a>00314                         <span class="keywordflow">if</span> (curpos &lt; maxpos)
<a name="l00315"></a>00315                                 curpos++;
<a name="l00316"></a>00316                         <span class="keywordflow">break</span>;
<a name="l00317"></a>00317                 <span class="keywordflow">case</span> SB_PAGEUP:    
<a name="l00318"></a>00318                         curpos = max(minpos, curpos - (<span class="keywordtype">int</span>) info.nPage);
<a name="l00319"></a>00319                         <span class="keywordflow">break</span>;
<a name="l00320"></a>00320                 <span class="keywordflow">case</span> SB_PAGEDOWN:
<a name="l00321"></a>00321                         curpos = min(maxpos, curpos + (<span class="keywordtype">int</span>) info.nPage);
<a name="l00322"></a>00322                         <span class="keywordflow">break</span>;
<a name="l00323"></a>00323                 <span class="keywordflow">case</span> SB_THUMBPOSITION: 
<a name="l00324"></a>00324                         curpos = nPos;     
<a name="l00325"></a>00325                         <span class="keywordflow">break</span>;
<a name="l00326"></a>00326                 <span class="keywordflow">case</span> SB_THUMBTRACK:
<a name="l00327"></a>00327                         curpos = nPos;     
<a name="l00328"></a>00328                         <span class="keywordflow">break</span>;
<a name="l00329"></a>00329     }    
<a name="l00330"></a>00330         <a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a> = curpos;
<a name="l00331"></a>00331         pScrollBar-&gt;SetScrollPos(curpos);
<a name="l00332"></a>00332         <a class="code" href="class_camera_dialog.html#68c035f44023413dc8cf738dc5236608">m_image</a>.Invalidate();
<a name="l00333"></a>00333     CDialog::OnVScroll(nSBCode, nPos, pScrollBar);
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00336"></a><a class="code" href="class_camera_dialog.html#d8ea379d3a44607234fd3f545aa09e90">00336</a> <span class="keywordtype">void</span> <a class="code" href="class_camera_dialog.html#d8ea379d3a44607234fd3f545aa09e90">CameraDialog::OnHScroll</a>(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar) 
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338         <span class="keywordtype">int</span> curpos = pScrollBar-&gt;GetScrollPos();
<a name="l00339"></a>00339         <span class="keywordtype">int</span> minpos;
<a name="l00340"></a>00340         <span class="keywordtype">int</span> maxpos;
<a name="l00341"></a>00341         pScrollBar-&gt;GetScrollRange(&amp;minpos, &amp;maxpos);
<a name="l00342"></a>00342         SCROLLINFO   info;
<a name="l00343"></a>00343     pScrollBar-&gt;GetScrollInfo(&amp;info, SIF_ALL);
<a name="l00344"></a>00344         <span class="keywordflow">switch</span> (nSBCode)
<a name="l00345"></a>00345     {
<a name="l00346"></a>00346                 <span class="keywordflow">case</span> SB_LEFT:      
<a name="l00347"></a>00347                         curpos = minpos;
<a name="l00348"></a>00348                         <span class="keywordflow">break</span>;
<a name="l00349"></a>00349                 <span class="keywordflow">case</span> SB_RIGHT:     
<a name="l00350"></a>00350                         curpos = maxpos;
<a name="l00351"></a>00351                         <span class="keywordflow">break</span>;
<a name="l00352"></a>00352                 <span class="keywordflow">case</span> SB_ENDSCROLL: 
<a name="l00353"></a>00353                         <span class="keywordflow">break</span>;
<a name="l00354"></a>00354                 <span class="keywordflow">case</span> SB_LINELEFT:      
<a name="l00355"></a>00355                         <span class="keywordflow">if</span> (curpos &gt; minpos)
<a name="l00356"></a>00356                                 curpos--;
<a name="l00357"></a>00357                         <span class="keywordflow">break</span>;
<a name="l00358"></a>00358                 <span class="keywordflow">case</span> SB_LINERIGHT:   
<a name="l00359"></a>00359                         <span class="keywordflow">if</span> (curpos &lt; maxpos)
<a name="l00360"></a>00360                                 curpos++;
<a name="l00361"></a>00361                         <span class="keywordflow">break</span>;
<a name="l00362"></a>00362                 <span class="keywordflow">case</span> SB_PAGELEFT:    
<a name="l00363"></a>00363                         curpos = max(minpos, curpos - (<span class="keywordtype">int</span>) info.nPage);
<a name="l00364"></a>00364                         <span class="keywordflow">break</span>;
<a name="l00365"></a>00365                 <span class="keywordflow">case</span> SB_PAGERIGHT:
<a name="l00366"></a>00366                         curpos = min(maxpos, curpos + (<span class="keywordtype">int</span>) info.nPage);
<a name="l00367"></a>00367                         <span class="keywordflow">break</span>;
<a name="l00368"></a>00368                 <span class="keywordflow">case</span> SB_THUMBPOSITION: 
<a name="l00369"></a>00369                         curpos = nPos;     
<a name="l00370"></a>00370                         <span class="keywordflow">break</span>;
<a name="l00371"></a>00371                 <span class="keywordflow">case</span> SB_THUMBTRACK:
<a name="l00372"></a>00372                         curpos = nPos;     
<a name="l00373"></a>00373                         <span class="keywordflow">break</span>;
<a name="l00374"></a>00374     }    
<a name="l00375"></a>00375         <a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a> = curpos; 
<a name="l00376"></a>00376         pScrollBar-&gt;SetScrollPos(curpos);
<a name="l00377"></a>00377         <a class="code" href="class_camera_dialog.html#68c035f44023413dc8cf738dc5236608">m_image</a>.Invalidate();
<a name="l00378"></a>00378         CDialog::OnHScroll(nSBCode, nPos, pScrollBar);
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00381"></a>00381 <span class="comment">// ==========================================================================</span>
<a name="l00382"></a>00382 <span class="comment">// -------------------------- CNumberListBox class --------------------------</span>
<a name="l00383"></a><a class="code" href="class_c_number_list_box.html#2f997f97e5dd09d9c38b6e954dc309b7">00383</a> <span class="keywordtype">void</span> <a class="code" href="class_c_number_list_box.html#2f997f97e5dd09d9c38b6e954dc309b7">CNumberListBox::Add</a>(<span class="keywordtype">int</span> number) {
<a name="l00384"></a>00384         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=((<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent());
<a name="l00385"></a>00385         dlg-&gt;<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>.Add(number);
<a name="l00386"></a>00386         <a class="code" href="class_c_number_list_box.html#7ae6048e3be31530f4a646c6fd4e1a15">UpdateData</a>(<span class="keyword">false</span>);
<a name="l00387"></a>00387 }
<a name="l00388"></a>00388 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00389"></a><a class="code" href="class_c_number_list_box.html#4be6b05fcf7c74a83f16395901b578f1">00389</a> <span class="keywordtype">void</span> <a class="code" href="class_c_number_list_box.html#4be6b05fcf7c74a83f16395901b578f1">CNumberListBox::Clear</a>() {
<a name="l00390"></a>00390         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=((<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent());
<a name="l00391"></a>00391         dlg-&gt;<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>.RemoveAll();
<a name="l00392"></a>00392         <a class="code" href="class_c_number_list_box.html#7ae6048e3be31530f4a646c6fd4e1a15">UpdateData</a>(<span class="keyword">false</span>);
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00395"></a><a class="code" href="class_c_number_list_box.html#50b3f71ad4cd5863bcf184955cdf778d">00395</a> <span class="keywordtype">void</span> <a class="code" href="class_c_number_list_box.html#50b3f71ad4cd5863bcf184955cdf778d">CNumberListBox::RemoveCurrent</a>() {
<a name="l00396"></a>00396         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=((<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent());
<a name="l00397"></a>00397         dlg-&gt;<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>.RemoveAt(GetCurSel());
<a name="l00398"></a>00398         <a class="code" href="class_c_number_list_box.html#7ae6048e3be31530f4a646c6fd4e1a15">UpdateData</a>(<span class="keyword">false</span>);
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00401"></a><a class="code" href="class_c_number_list_box.html#7ae6048e3be31530f4a646c6fd4e1a15">00401</a> <span class="keywordtype">void</span> <a class="code" href="class_c_number_list_box.html#7ae6048e3be31530f4a646c6fd4e1a15">CNumberListBox::UpdateData</a>(BOOL bSaveAndValidate) {
<a name="l00402"></a>00402         CListBox::UpdateData(bSaveAndValidate);
<a name="l00403"></a>00403         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=((<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent());
<a name="l00404"></a>00404         <span class="keywordflow">if</span> (bSaveAndValidate) {
<a name="l00405"></a>00405                 dlg-&gt;<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>.RemoveAll();
<a name="l00406"></a>00406                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;GetCount();i++)
<a name="l00407"></a>00407                         dlg-&gt;<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>[i] = (DWORD) GetItemData(i);
<a name="l00408"></a>00408         }
<a name="l00409"></a>00409         <span class="keywordflow">else</span> {
<a name="l00410"></a>00410                 <span class="keywordflow">while</span>(GetCount() &gt; 0)
<a name="l00411"></a>00411                         DeleteString(0);
<a name="l00412"></a>00412                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;dlg-&gt;<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>.GetCount();i++) {
<a name="l00413"></a>00413                         <span class="keywordtype">char</span> name[20];
<a name="l00414"></a>00414                         StringCchPrintf(name, 20, <span class="stringliteral">"line %d is %d cm"</span>, GetCount()+1, dlg-&gt;<a class="code" href="class_camera_model.html#c01a00491f8e8a984814192917154e5a">num</a>[i]);
<a name="l00415"></a>00415                         AddString(name);
<a name="l00416"></a>00416                 }
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418 }
<a name="l00419"></a>00419 <span class="comment">// =========================================================================</span>
<a name="l00420"></a>00420 <span class="comment">// --------------------- CCalibrateControl class ---------------------------</span>
<a name="l00421"></a><a class="code" href="class_c_calibrate_control.html#055a8977b4ab6f55853e27c948047495">00421</a> <a class="code" href="class_c_calibrate_control.html#055a8977b4ab6f55853e27c948047495">CCalibrateControl::CCalibrateControl</a>() {
<a name="l00422"></a>00422         <a class="code" href="class_c_calibrate_control.html#d56e467c92e0f00a98232e5ed2bd9850">m_dragging</a> = <span class="keyword">false</span>;
<a name="l00423"></a>00423         <a class="code" href="class_c_calibrate_control.html#71b974cbfbd42c9627d2910a7d04f4a2">m_creating</a> = <span class="keyword">false</span>;
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 <span class="comment">// --------------------- CCalibrateControl class ---------------------------</span>
<a name="l00426"></a><a class="code" href="class_c_calibrate_control.html#c1df77f586b74eec9a1a2c1715b4fe8d">00426</a> <span class="keywordtype">bool</span> <a class="code" href="class_c_calibrate_control.html#c1df77f586b74eec9a1a2c1715b4fe8d">CCalibrateControl::Initialize</a>(<a class="code" href="class_c_new_vision_doc.html">CNewVisionDoc</a>* doc) {
<a name="l00427"></a>00427         <span class="comment">// Get first frame from file or camera</span>
<a name="l00428"></a>00428         <a class="code" href="class_c_calibrate_control.html#0a7d91ef25191469145523c4911b8a75">image</a>.CopyOf(<a class="code" href="_globals_8cpp.html#dcc8eea4165f02dc8d32606c13087c67">imgFrame</a>);
<a name="l00429"></a>00429         <span class="comment">// Show scroll bars</span>
<a name="l00430"></a>00430         <span class="keywordflow">if</span> (m_hWnd) {
<a name="l00431"></a>00431                 <a class="code" href="class_camera_dialog.html">CameraDialog</a>* tab = (<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)GetParent();
<a name="l00432"></a>00432                 CRect r; this-&gt;GetWindowRect(&amp;r);
<a name="l00433"></a>00433                 SCROLLINFO horz;
<a name="l00434"></a>00434                 horz.cbSize = <span class="keyword">sizeof</span>(SCROLLINFO);
<a name="l00435"></a>00435                 horz.fMask = SIF_ALL;
<a name="l00436"></a>00436                 horz.nPage = 50;
<a name="l00437"></a>00437                 horz.nMin = 0;
<a name="l00438"></a>00438                 horz.nMax = <a class="code" href="class_c_calibrate_control.html#0a7d91ef25191469145523c4911b8a75">image</a>.Width()-r.Width()+horz.nPage;
<a name="l00439"></a>00439                 horz.nPos = 0;
<a name="l00440"></a>00440                 horz.nTrackPos = 0;
<a name="l00441"></a>00441                 tab-&gt;<a class="code" href="class_camera_dialog.html#c8d19918bf1acb7187929f0db5ad11e5">m_hbar</a>.SetScrollInfo(&amp;horz);
<a name="l00442"></a>00442                 SCROLLINFO vert;
<a name="l00443"></a>00443                 vert.cbSize = <span class="keyword">sizeof</span>(SCROLLINFO);
<a name="l00444"></a>00444                 vert.fMask = SIF_ALL;
<a name="l00445"></a>00445                 vert.nPage = 50;
<a name="l00446"></a>00446                 vert.nMin = 0;
<a name="l00447"></a>00447                 vert.nMax = <a class="code" href="class_c_calibrate_control.html#0a7d91ef25191469145523c4911b8a75">image</a>.Height()-r.Height()+vert.nPage;
<a name="l00448"></a>00448                 vert.nPos = 0;
<a name="l00449"></a>00449                 vert.nTrackPos = 0;
<a name="l00450"></a>00450                 tab-&gt;<a class="code" href="class_camera_dialog.html#dc29a20cf419ade9d3f78955f31be36e">m_vbar</a>.SetScrollInfo(&amp;vert);
<a name="l00451"></a>00451                 tab-&gt;<a class="code" href="class_camera_dialog.html#dc29a20cf419ade9d3f78955f31be36e">m_vbar</a>.ShowWindow(<span class="keyword">true</span>);  <span class="comment">//Hide Vertical Scroll Bar</span>
<a name="l00452"></a>00452                 tab-&gt;<a class="code" href="class_camera_dialog.html#c8d19918bf1acb7187929f0db5ad11e5">m_hbar</a>.ShowWindow(<span class="keyword">true</span>);  <span class="comment">//Hide Horizontal Scroll Bar</span>
<a name="l00453"></a>00453                 tab-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a> = 0; tab-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a> = 0;
<a name="l00454"></a>00454                 this-&gt;Invalidate();
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00459"></a><a class="code" href="class_c_calibrate_control.html#40ce325cc1328ab361e2036611351b6c">00459</a> <span class="keywordtype">void</span> <a class="code" href="class_c_calibrate_control.html#40ce325cc1328ab361e2036611351b6c">CCalibrateControl::DrawItem</a>(LPDRAWITEMSTRUCT lpDrawItemStruct) {
<a name="l00460"></a>00460         CDC* pDC = CDC::FromHandle(lpDrawItemStruct-&gt;hDC);
<a name="l00461"></a>00461         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=(<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent();
<a name="l00462"></a>00462         <a class="code" href="class_c_calibrate_control.html#0a7d91ef25191469145523c4911b8a75">image</a>.Show(pDC-&gt;m_hDC, 0, 0, <a class="code" href="class_c_calibrate_control.html#0a7d91ef25191469145523c4911b8a75">image</a>.Width(), <a class="code" href="class_c_calibrate_control.html#0a7d91ef25191469145523c4911b8a75">image</a>.Height(), dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00463"></a>00463         
<a name="l00464"></a>00464         CPen red(PS_SOLID, 1, RGB(255, 0, 0));
<a name="l00465"></a>00465         CPen green(PS_SOLID, 1, RGB(0, 255, 0));
<a name="l00466"></a>00466         CPen blue(PS_SOLID, 1, RGB(0, 0, 255));
<a name="l00467"></a>00467         CPen aqua(PS_SOLID, 1, RGB(0, 255, 255));
<a name="l00468"></a>00468         <a class="code" href="class_c_calibrate_control.html#fe97b207cf6c99959a5155969755258c">DrawLines</a>(pDC, dlg-&gt;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>, &amp;red);
<a name="l00469"></a>00469         <a class="code" href="class_c_calibrate_control.html#fe97b207cf6c99959a5155969755258c">DrawLines</a>(pDC, dlg-&gt;<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>, &amp;green);
<a name="l00470"></a>00470         <a class="code" href="class_c_calibrate_control.html#fe97b207cf6c99959a5155969755258c">DrawLines</a>(pDC, dlg-&gt;<a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>, &amp;blue);
<a name="l00471"></a>00471         <a class="code" href="class_c_calibrate_control.html#fe97b207cf6c99959a5155969755258c">DrawLines</a>(pDC, dlg-&gt;<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>, &amp;aqua);
<a name="l00472"></a>00472         
<a name="l00473"></a>00473         
<a name="l00474"></a>00474         <span class="comment">// draw vanishing points !!!!!!!!!</span>
<a name="l00475"></a>00475         CvPoint VX = cvPointFrom32f(dlg-&gt;<a class="code" href="class_camera_model.html#5d0c9ba363f2443e5d53112ff35ff7eb">coordsHomo2Image</a>(dlg-&gt;<a class="code" href="class_camera_model.html#0cf603db0c3ffde14a382a406984c614">VX</a>));
<a name="l00476"></a>00476         CvPoint VY = cvPointFrom32f(dlg-&gt;<a class="code" href="class_camera_model.html#5d0c9ba363f2443e5d53112ff35ff7eb">coordsHomo2Image</a>(dlg-&gt;<a class="code" href="class_camera_model.html#98015c3069e12b5c71ccbc63a4ab0ea7">VY</a>));
<a name="l00477"></a>00477         CvPoint VZ = cvPointFrom32f(dlg-&gt;<a class="code" href="class_camera_model.html#5d0c9ba363f2443e5d53112ff35ff7eb">coordsHomo2Image</a>(dlg-&gt;<a class="code" href="class_camera_model.html#e84288c553968b8906c6d861eed797b8">VZ</a>));
<a name="l00478"></a>00478         CBrush bred(RGB(255, 0, 0));
<a name="l00479"></a>00479         CBrush bgreen(RGB(0, 255, 0));
<a name="l00480"></a>00480         CBrush bblue(RGB(0, 0, 255));
<a name="l00481"></a>00481         pDC-&gt;SelectObject(bred);
<a name="l00482"></a>00482         pDC-&gt;Ellipse(VX.x-2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, VX.y-2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>, VX.x+2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, VX.y+2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00483"></a>00483         pDC-&gt;SelectObject(bgreen);
<a name="l00484"></a>00484         pDC-&gt;Ellipse(VY.x-2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, VY.y-2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>, VY.x+2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, VY.y+2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00485"></a>00485         pDC-&gt;SelectObject(bblue);
<a name="l00486"></a>00486         pDC-&gt;Ellipse(VZ.x-2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, VZ.y-2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>, VZ.x+2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, VZ.y+2*<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00487"></a>00487         
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00490"></a><a class="code" href="class_c_calibrate_control.html#fe97b207cf6c99959a5155969755258c">00490</a> <span class="keywordtype">void</span> <a class="code" href="class_c_calibrate_control.html#fe97b207cf6c99959a5155969755258c">CCalibrateControl::DrawLines</a>(CDC* pDC, <a class="code" href="class_c_array.html">CArray&lt;CLine&gt;</a>&amp; x, CPen* pen) {
<a name="l00491"></a>00491         CBrush light(RGB(255, 255, 0));
<a name="l00492"></a>00492         CBrush dark(RGB(50, 50, 0));
<a name="l00493"></a>00493         CBrush* pOldBrush = pDC-&gt;SelectObject(&amp;dark);
<a name="l00494"></a>00494         CPen* pOldPen = pDC-&gt;SelectObject(pen);
<a name="l00495"></a>00495         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=(<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent();
<a name="l00496"></a>00496         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;x.GetCount();i++) {
<a name="l00497"></a>00497                 CPoint p1 = CPoint(x[i].p1.x-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, x[i].p1.y-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>); 
<a name="l00498"></a>00498                 CPoint p2 = CPoint(x[i].p2.x-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, x[i].p2.y-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500                 <span class="comment">// draw a line</span>
<a name="l00501"></a>00501                 pDC-&gt;SelectObject(pen);
<a name="l00502"></a>00502                 pDC-&gt;MoveTo(p1);
<a name="l00503"></a>00503                 pDC-&gt;LineTo(p2);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505                 <span class="comment">// draw numbered boxes</span>
<a name="l00506"></a>00506                 pDC-&gt;SetBkColor(RGB(0,100,100));
<a name="l00507"></a>00507                 pDC-&gt;SetTextColor(RGB(255,255,255));
<a name="l00508"></a>00508                 <span class="keywordtype">char</span> c[3];
<a name="l00509"></a>00509                 pDC-&gt;DrawText(itoa(i+1, c, 10), CRect(p1, CSize(12*((i%10)+1), 16)), DT_SINGLELINE);
<a name="l00510"></a>00510                 pDC-&gt;DrawText(itoa(i+1, c, 10), CRect(p2, CSize(12*((i%10)+1), 16)), DT_SINGLELINE);
<a name="l00511"></a>00511                 
<a name="l00512"></a>00512                 <span class="comment">// draw endpoints</span>
<a name="l00513"></a>00513                 pDC-&gt;SelectObject(&amp;dark);
<a name="l00514"></a>00514                 pDC-&gt;Ellipse(p1.x-<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>, p1.y-<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>, p1.x+<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>, p1.y+<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>);
<a name="l00515"></a>00515                 pDC-&gt;Ellipse(p2.x-<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>, p2.y-<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>, p2.x+<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>, p2.y+<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>);
<a name="l00516"></a>00516                 <span class="keywordflow">if</span> (<a class="code" href="class_c_calibrate_control.html#d56e467c92e0f00a98232e5ed2bd9850">m_dragging</a>) {
<a name="l00517"></a>00517                         pDC-&gt;SelectObject(&amp;light);
<a name="l00518"></a>00518                         pDC-&gt;Ellipse(<a class="code" href="class_c_calibrate_control.html#087a3aa36316ae6d2f6e7882039b04c3">m_dragPoint</a>-&gt;x-<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, <a class="code" href="class_c_calibrate_control.html#087a3aa36316ae6d2f6e7882039b04c3">m_dragPoint</a>-&gt;y-<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>, <a class="code" href="class_c_calibrate_control.html#087a3aa36316ae6d2f6e7882039b04c3">m_dragPoint</a>-&gt;x+<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, <a class="code" href="class_c_calibrate_control.html#087a3aa36316ae6d2f6e7882039b04c3">m_dragPoint</a>-&gt;y+<a class="code" href="class_c_calibrate_control.html#8d578b8a10a773f7df4739dc7276f280">DOT</a>-dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00519"></a>00519                 }       
<a name="l00520"></a>00520         }
<a name="l00521"></a>00521         pDC-&gt;SelectObject(pOldBrush);
<a name="l00522"></a>00522         pDC-&gt;SelectObject(pOldPen);
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00525"></a><a class="code" href="class_c_calibrate_control.html#2a40406522193f3efc71b78b78ea78cd">00525</a> BOOL <a class="code" href="class_c_calibrate_control.html#2a40406522193f3efc71b78b78ea78cd">CCalibrateControl::OnWndMsg</a>(UINT message, WPARAM wParam, LPARAM lParam, LRESULT* pResult) 
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527         <span class="keywordflow">if</span>( (message == WM_LBUTTONDOWN) ||   
<a name="l00528"></a>00528                 (message == WM_MBUTTONDOWN) ||
<a name="l00529"></a>00529                 (message == WM_RBUTTONDOWN) )
<a name="l00530"></a>00530                 <a class="code" href="class_c_calibrate_control.html#e0bcbf7725ef35b1c4894cc0cc9b9b59">OnButtonDown</a>(LOWORD(wParam), CPoint(lParam));
<a name="l00531"></a>00531         <span class="keywordflow">if</span>( (message == WM_LBUTTONUP) ||   
<a name="l00532"></a>00532                 (message == WM_MBUTTONUP) ||
<a name="l00533"></a>00533                 (message == WM_RBUTTONUP) )
<a name="l00534"></a>00534                 <a class="code" href="class_c_calibrate_control.html#5170d28487727030c18e7c60f466ed77">OnButtonUp</a>(LOWORD(wParam), CPoint(lParam));
<a name="l00535"></a>00535         <span class="keywordflow">if</span>( message == WM_KEYDOWN &amp;&amp; <a class="code" href="class_c_calibrate_control.html#d56e467c92e0f00a98232e5ed2bd9850">m_dragging</a> &amp;&amp; wParam == VK_DELETE ) {
<a name="l00536"></a>00536                 <a class="code" href="class_c_calibrate_control.html#eaf4ceeae291b22a431223d8f4e269b7">m_dragArray</a>-&gt;RemoveAt(<a class="code" href="class_c_calibrate_control.html#a6bd2ffbdb08c7d82a52d46733da9dd3">m_dragLine</a>);
<a name="l00537"></a>00537                 Invalidate();
<a name="l00538"></a>00538                 UpdateWindow();
<a name="l00539"></a>00539         }
<a name="l00540"></a>00540         <span class="keywordflow">return</span> CWnd::OnWndMsg(message, wParam, lParam, pResult);
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00543"></a><a class="code" href="class_c_calibrate_control.html#e0bcbf7725ef35b1c4894cc0cc9b9b59">00543</a> <span class="keywordtype">void</span> <a class="code" href="class_c_calibrate_control.html#e0bcbf7725ef35b1c4894cc0cc9b9b59">CCalibrateControl::OnButtonDown</a>(UINT nFlags, CPoint point) {
<a name="l00544"></a>00544         CWnd::OnLButtonDown(nFlags, point);
<a name="l00545"></a>00545         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=((<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent());
<a name="l00546"></a>00546         point.x += dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>;
<a name="l00547"></a>00547         point.y += dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>;
<a name="l00548"></a>00548         <span class="keywordflow">if</span> (!<a class="code" href="class_c_calibrate_control.html#540105c36232b1127647a9afd7d3a87f">ChangeLine</a>(dlg-&gt;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>, point) 
<a name="l00549"></a>00549                 &amp;&amp; !<a class="code" href="class_c_calibrate_control.html#540105c36232b1127647a9afd7d3a87f">ChangeLine</a>(dlg-&gt;<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>, point) 
<a name="l00550"></a>00550                 &amp;&amp; !<a class="code" href="class_c_calibrate_control.html#540105c36232b1127647a9afd7d3a87f">ChangeLine</a>(dlg-&gt;<a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>, point) 
<a name="l00551"></a>00551                 &amp;&amp; !<a class="code" href="class_c_calibrate_control.html#540105c36232b1127647a9afd7d3a87f">ChangeLine</a>(dlg-&gt;<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>, point)) {
<a name="l00552"></a>00552                 <span class="comment">// create new point</span>
<a name="l00553"></a>00553                 <a class="code" href="class_c_line.html">CLine</a> l = <a class="code" href="class_c_line.html">CLine</a>(point, point);
<a name="l00554"></a>00554                 <span class="keywordflow">if</span> (nFlags &amp; MK_CONTROL) {
<a name="l00555"></a>00555                         dlg-&gt;<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.Add(l); <a class="code" href="class_c_calibrate_control.html#988a77e239cff5121775b2eeeff3a175">m_createPoint</a> = &amp;(dlg-&gt;<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>[dlg-&gt;<a class="code" href="class_camera_model.html#44ab278be74a75fe53e263fcadc0391f">r</a>.GetCount()-1].p2);
<a name="l00556"></a>00556                 }
<a name="l00557"></a>00557                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nFlags &amp; MK_LBUTTON) {
<a name="l00558"></a>00558                         dlg-&gt;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>.Add(l); <a class="code" href="class_c_calibrate_control.html#988a77e239cff5121775b2eeeff3a175">m_createPoint</a> = &amp;(dlg-&gt;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>[dlg-&gt;<a class="code" href="class_camera_model.html#6ac0bb65e588a4d44ca8592cd8c946df">x</a>.GetCount()-1].p2);
<a name="l00559"></a>00559                 }
<a name="l00560"></a>00560                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nFlags &amp; MK_MBUTTON) {
<a name="l00561"></a>00561                         dlg-&gt;<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>.Add(l); <a class="code" href="class_c_calibrate_control.html#988a77e239cff5121775b2eeeff3a175">m_createPoint</a> = &amp;(dlg-&gt;<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>[dlg-&gt;<a class="code" href="class_camera_model.html#8a36c34fcdc4730e315bed9de382e55c">y</a>.GetCount()-1].p2);
<a name="l00562"></a>00562                 }
<a name="l00563"></a>00563                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nFlags &amp; MK_RBUTTON) {
<a name="l00564"></a>00564                         dlg-&gt;<a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>.Add(l); <a class="code" href="class_c_calibrate_control.html#988a77e239cff5121775b2eeeff3a175">m_createPoint</a> = &amp;(dlg-&gt;<a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>[dlg-&gt;<a class="code" href="class_camera_model.html#85f8f9ef21bf7753f4f54df19e5f8c74">z</a>.GetCount()-1].p2);
<a name="l00565"></a>00565                 }
<a name="l00566"></a>00566                 <a class="code" href="class_c_calibrate_control.html#71b974cbfbd42c9627d2910a7d04f4a2">m_creating</a> = <span class="keyword">true</span>;
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568 }
<a name="l00569"></a>00569 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00570"></a><a class="code" href="class_c_calibrate_control.html#540105c36232b1127647a9afd7d3a87f">00570</a> <span class="keywordtype">bool</span> <a class="code" href="class_c_calibrate_control.html#540105c36232b1127647a9afd7d3a87f">CCalibrateControl::ChangeLine</a>(<a class="code" href="class_c_array.html">CArray&lt;CLine&gt;</a>&amp; l, CPoint point) {
<a name="l00571"></a>00571         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;l.GetCount();i++) {
<a name="l00572"></a>00572                 CRect rect1 = CRect(l[i].p1, CSize(12*((i%10)+1), 16)); <span class="comment">// i&gt;0 first time?</span>
<a name="l00573"></a>00573                 CRect rect2 = CRect(l[i].p2, CSize(12*((i%10)+1), 16));
<a name="l00574"></a>00574                 <span class="keywordflow">if</span>(rect1.PtInRect(point)) {
<a name="l00575"></a>00575                         <a class="code" href="class_c_calibrate_control.html#d56e467c92e0f00a98232e5ed2bd9850">m_dragging</a> = <span class="keyword">true</span>;
<a name="l00576"></a>00576                         <a class="code" href="class_c_calibrate_control.html#087a3aa36316ae6d2f6e7882039b04c3">m_dragPoint</a> = &amp;(l[i].p1);
<a name="l00577"></a>00577                         <a class="code" href="class_c_calibrate_control.html#a6bd2ffbdb08c7d82a52d46733da9dd3">m_dragLine</a> = i;
<a name="l00578"></a>00578                         <a class="code" href="class_c_calibrate_control.html#eaf4ceeae291b22a431223d8f4e269b7">m_dragArray</a> = &amp;l;
<a name="l00579"></a>00579                         Invalidate();
<a name="l00580"></a>00580                         UpdateWindow();
<a name="l00581"></a>00581                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583                 }
<a name="l00584"></a>00584                 <span class="keywordflow">if</span>(rect2.PtInRect(point)) {
<a name="l00585"></a>00585                         <a class="code" href="class_c_calibrate_control.html#d56e467c92e0f00a98232e5ed2bd9850">m_dragging</a> = <span class="keyword">true</span>;
<a name="l00586"></a>00586                         <a class="code" href="class_c_calibrate_control.html#087a3aa36316ae6d2f6e7882039b04c3">m_dragPoint</a> = &amp;(l[i].p2);
<a name="l00587"></a>00587                         <a class="code" href="class_c_calibrate_control.html#a6bd2ffbdb08c7d82a52d46733da9dd3">m_dragLine</a> = i;
<a name="l00588"></a>00588                         <a class="code" href="class_c_calibrate_control.html#eaf4ceeae291b22a431223d8f4e269b7">m_dragArray</a> = &amp;l;
<a name="l00589"></a>00589                         Invalidate();
<a name="l00590"></a>00590                         UpdateWindow();
<a name="l00591"></a>00591                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00592"></a>00592                 }
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594         <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// line unchanged</span>
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00597"></a><a class="code" href="class_c_calibrate_control.html#8385cc50226682159d5ee1382f528ae4">00597</a> afx_msg <span class="keywordtype">void</span> <a class="code" href="class_c_calibrate_control.html#8385cc50226682159d5ee1382f528ae4">CCalibrateControl::OnMouseMove</a>(UINT nFlags, CPoint point) {
<a name="l00598"></a>00598         <a class="code" href="class_camera_dialog.html">CameraDialog</a>* dlg=((<a class="code" href="class_camera_dialog.html">CameraDialog</a>*)this-&gt;GetParent());
<a name="l00599"></a>00599         <span class="keywordflow">if</span> (<a class="code" href="class_c_calibrate_control.html#d56e467c92e0f00a98232e5ed2bd9850">m_dragging</a>) {
<a name="l00600"></a>00600                 *<a class="code" href="class_c_calibrate_control.html#087a3aa36316ae6d2f6e7882039b04c3">m_dragPoint</a> = CPoint(point.x + dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, point.y + dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00601"></a>00601                 Invalidate();
<a name="l00602"></a>00602                 UpdateWindow();
<a name="l00603"></a>00603         }
<a name="l00604"></a>00604         <span class="keywordflow">if</span> (<a class="code" href="class_c_calibrate_control.html#71b974cbfbd42c9627d2910a7d04f4a2">m_creating</a>) {
<a name="l00605"></a>00605                 *<a class="code" href="class_c_calibrate_control.html#988a77e239cff5121775b2eeeff3a175">m_createPoint</a> = CPoint(point.x + dlg-&gt;<a class="code" href="class_camera_dialog.html#ac9fd5fb2ab7d57dd1f5bee77f007c8b">offsetx</a>, point.y + dlg-&gt;<a class="code" href="class_camera_dialog.html#bac2f91f00430e81e92e21d6fc4c7ee2">offsety</a>);
<a name="l00606"></a>00606                 Invalidate();
<a name="l00607"></a>00607                 UpdateWindow();
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00611"></a><a class="code" href="class_c_calibrate_control.html#5170d28487727030c18e7c60f466ed77">00611</a> <span class="keywordtype">void</span> <a class="code" href="class_c_calibrate_control.html#5170d28487727030c18e7c60f466ed77">CCalibrateControl::OnButtonUp</a>(UINT nFlags, CPoint point) {
<a name="l00612"></a>00612         <a class="code" href="class_c_calibrate_control.html#d56e467c92e0f00a98232e5ed2bd9850">m_dragging</a> = <span class="keyword">false</span>;
<a name="l00613"></a>00613         <a class="code" href="class_c_calibrate_control.html#71b974cbfbd42c9627d2910a7d04f4a2">m_creating</a> = <span class="keyword">false</span>;
<a name="l00614"></a>00614         Invalidate();
<a name="l00615"></a>00615         UpdateWindow();
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Apr 24 22:32:50 2007 for New Vision by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>NewVision: Body.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>Body.h</h1><div class="fragment"><pre>00001 <span class="comment">/* ============================================================================</span>
00002 <span class="comment">BODY - represents a vercally oriented spheroid in 3D coordinates.</span>
00003 <span class="comment">The bottom pole (bot) of the spheroid has Z=0 , i.e. is on the floor.</span>
00004 <span class="comment">Depending on the camera model, spheroid can project onto the images differently.</span>
00005 <span class="comment">This is a non-persistent, non-serializable single frame modelling class. </span>
00006 <span class="comment">For persistancy and frame to frame history, see class BodyPath and  </span>
00007 <span class="comment">SaveToBodyHistory(int nFrame) and   LoadFromBodyHistory(int nFrame) from class ActivityModel.</span>
00008 <span class="comment">============================================================================ */</span>
00009 
00010 <span class="preprocessor">#if !defined( BODY_H )</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define BODY_H</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#pragma once</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "cv.h"</span>    
00015 <span class="preprocessor">#include "Object3D.h"</span>  
00016 <span class="preprocessor">#include "LABHistogram2D.h"</span>
00017 
00018 <span class="preprocessor">#define INITIAL_WIDTH_RATIO 0.4</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define HEAD_HEIGHT 1.0/5</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define HEAD_WIDTH 2.0/5</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#define ARROW_LENGTH 200   // arrows of ... cm</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define SECTOR_ANGLE PI/10</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define PREV_ORIENT_WEIGHT 0.8</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#define FACE_ORIENT_WEIGHT 0.2</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define MOTION_ORIENT_WEIGHT 0.8</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define MAX_COLOR_MATCHES 20</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define MAX_VELOCITY 10</span>
00028 <span class="preprocessor"></span>
00029 <span class="keyword">class </span>Blob;
00030 <span class="keyword">class </span>BodyPath;
00031 <span class="keyword">struct </span>BlobRay;
00032 
00033 <span class="keyword">class </span>Body : <span class="keyword">public</span> Object3D {
00034     DECLARE_DYNAMIC(Body)
00035     <span class="keyword">public</span>:
00036         <span class="comment">// Attributes</span>
00037         CvPoint3D32f   top, bot;    <span class="comment">// head and floor position in 2D image coordinates</span>
00038         CvPoint3D32f   predicted;   <span class="comment">// predicted foot position</span>
00039         <span class="keywordtype">double</span>         orientation; <span class="comment">// orientation angle [0 = looking along X-axis; increasing counter-clockwise to PI, decreasing clockwise to -PI]</span>
00040         CvKalman*      posKalman;   <span class="comment">// Kalman filter tracks the position of the body on the 2D floor (using 1st order motion model)</span>
00041         CvKalman*      orientKalman;<span class="comment">// Kalman filter tracks the orientation of the head (using 2nd order motion model)</span>
00042         LABHistogram2D color;
00043         <span class="keywordtype">double</span>         widthRatio;
00044         <span class="keywordtype">int</span>            id;
00045         <span class="keywordtype">int</span>            blobid;
00046         <span class="keywordtype">int</span>            startFrame;
00047         <span class="keywordtype">int</span>            stopFrame;
00048         <span class="keywordtype">int</span>            invisibleFor;  
00049         <span class="keywordtype">int</span>            dormantFor;  
00050         <span class="keywordtype">int</span>            outsiderFor;  
00051         CvPoint p1, p2;      <span class="comment">// bounding box corners</span>
00052         CvPoint2D32f   hc_prev;
00053 
00054         <span class="comment">// Display variables</span>
00055         <span class="keywordtype">double</span>         prior, likelyhood;
00056         <span class="keywordtype">double</span>         dHist;
00057 
00058         <span class="comment">// Methods</span>
00059                         Body(<span class="keywordtype">void</span>);
00060                         Body(<span class="keyword">const</span> Body&amp; b);
00061                         Body(CvPoint2D32f point, <span class="keywordtype">double</span> height, <span class="keywordtype">double</span> width, CNewVisionDoc* doc, <span class="keywordtype">int</span> id, <span class="keywordtype">int</span> frameNumber);
00062                         Body(BodyPath* path, CNewVisionDoc* doc, <span class="keywordtype">int</span> frameNumber);
00063                         Body(BlobRay* r, CNewVisionDoc* doc, <span class="keywordtype">int</span> id, <span class="keywordtype">int</span> frameNumber);
00064         Body&amp;           operator=(<span class="keyword">const</span> Body&amp; that);
00065                         ~Body(<span class="keywordtype">void</span>);
00066         <span class="keywordtype">void</span>            HistogramCompute(IplImage* frame, CvHistogram* hist, <span class="keywordtype">int</span> accumulate=0);
00067         <span class="keywordtype">void</span>            HistogramUpdate(IplImage* frame);
00068         <span class="keywordtype">void</span>            MoveTo(CvPoint3D32f f3);
00069         <span class="keywordtype">void</span>            MoveHeadTo(CvPoint3D32f h3);
00070         CvPoint3D32f    MeanShift(IplImage* frame, IplImage* BGmask);
00071         CvPoint3D32f    MeanShiftGetCenter(IplImage* frame, IplImage* BGmask, CvPoint3D32f foot);
00072         <span class="keywordtype">void</span>            KalmanInit();
00073         <span class="keywordtype">void</span>            KalmanCopy(CvKalman* src, CvKalman* dst);
00074         <span class="keywordtype">void</span>            KalmanPredict();
00075         <span class="keywordtype">void</span>            KalmanObserve();
00076         CvPoint3D32f    GetHead();
00077         CvPoint3D32f    GetFoot();
00078         CvPoint3D32f    GetCenter();
00079         CvPoint2D32f    GetImageFaceCenter(IplImage* frame, <span class="keywordtype">double</span>&amp; nMatches);
00080         CvPoint3D32f    GetFaceCenter(IplImage* frame, <span class="keywordtype">double</span>&amp; nMatches);
00081         CvPoint2D32f    GetImageHeadCenter();
00082         CvPoint3D32f    GetHeadCenter();
00083         CvPoint2D32f    GetImageHeadOpticalFlow(IplImage* frame);
00084         <span class="keywordtype">double</span>          GetFaceOrientation(IplImage* frame);
00085 
00086         CvPoint2D32f    GetImageHead();
00087         CvPoint2D32f    GetImageFoot();
00088         CvPoint2D32f    GetImageCenter();
00089         <span class="keywordtype">double</span>          GetHeight();
00090         <span class="keywordtype">void</span>            SetHeight(<span class="keywordtype">double</span> h);
00091         <span class="keywordtype">double</span>          GetWidth();
00092         <span class="keywordtype">void</span>            SetWidth(<span class="keywordtype">double</span> w);
00093         CvSize2D32f     GetAxes();
00094         <span class="keywordtype">double</span>          GetVisiblePixelSize(); <span class="comment">// returns visible body projection size in pixels</span>
00095         <span class="keywordtype">double</span>          GetDistanceFromCamera(); <span class="comment">// distance from camera center in centimeters</span>
00096         CvRect          GetBoundingRect();
00097         <span class="keywordtype">bool</span>            OutOfBounds(CvPoint2D32f p, IplImage* frame); 
00098 <span class="keyword">virtual</span> <span class="keywordtype">void</span>            GetOccludedFloorArea(CvSeq* points);
00099 <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawFloor(IplImage* frame, CvScalar color) {};
00100 <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawFloor(CDC* pDC, <span class="keywordtype">int</span> ox, <span class="keywordtype">int</span> oy, CPen* pen) {};
00101 <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawFrame(IplImage* frame, CvScalar color);
00102 <span class="keyword">virtual</span> <span class="keywordtype">void</span>            DrawFrame(CDC* pDC , <span class="keywordtype">int</span> ox, <span class="keywordtype">int</span> oy, CPen* pen) {};
00103 <span class="keyword">virtual</span> <span class="keywordtype">void</span>            RasterizeFrame(IplImage* frame, CvScalar color=CV_RGB(255,255,255));
00104 <span class="keyword">virtual</span> <span class="keywordtype">void</span>            RasterizeFloor(IplImage* frame, CvScalar color=CV_RGB(255,255,255));
00105         <span class="keywordtype">void</span>            DrawCurrentVsPredicted(IplImage* frame, CvScalar color);
00106         <span class="keywordtype">void</span>            DrawHeadArea(IplImage* frame, CvScalar color);
00107         <span class="keywordtype">void</span>            DrawHeight(IplImage* frame, CvScalar color);
00108         <span class="keywordtype">void</span>            DrawHeadCenter(IplImage* frame, CvScalar color);
00109         <span class="keywordtype">void</span>            DrawFaceCenter(IplImage* frame, CvScalar color);
00110         <span class="keywordtype">void</span>            DrawSectorHighlight(IplImage* frame);
00111         <span class="keywordtype">void</span>            DrawOrientationArrow(IplImage* frame, CvScalar color);
00112         <span class="keywordtype">void</span>            DrawSalesRepMark(IplImage * frame, CvScalar color);
00113         <span class="keywordtype">void</span>            DrawSalesRepTempMark(IplImage * frame, CvScalar color);
00114         <span class="keywordtype">void</span>            DrawDwellMark(IplImage * frame, CvScalar color);
00115         <span class="keywordtype">void</span>            DrawWeightMask(IplImage* frame);
00116         <span class="keywordtype">void</span>            RasterizeHead(IplImage* frame, CvScalar color);
00117         <span class="keywordtype">void</span>            DrawHistogram(IplImage* frame, <span class="keywordtype">int</span> scale=0, CvPoint p=cvPoint(0,0));
00118 <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            IsFramePointIn(CvPoint point, CvPoint3D32f&amp; pcurrent) {<span class="keywordflow">return</span> <span class="keyword">false</span>;};
00119 <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            IsFloorPointIn(CvPoint point, CvPoint3D32f&amp; pcurrent) {<span class="keywordflow">return</span> <span class="keyword">false</span>;};
00120 <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            Move(CvPoint3D32f p) {<span class="keywordflow">return</span> <span class="keyword">true</span>;};
00121 <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            Move1(CvPoint2D32f p) {<span class="keywordflow">return</span> <span class="keyword">true</span>;};
00122 <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            Move2(CvPoint2D32f p) {<span class="keywordflow">return</span> <span class="keyword">true</span>;};
00123 <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            Move3(CvPoint2D32f p) {<span class="keywordflow">return</span> <span class="keyword">true</span>;};
00124 <span class="keyword">virtual</span> <span class="keywordtype">bool</span>            Move4(CvPoint2D32f p) {<span class="keywordflow">return</span> <span class="keyword">true</span>;};
00125 
00126     <span class="keyword">private</span>:
00127         <span class="keyword">static</span> <span class="keywordtype">double</span>   weights_scale; <span class="comment">// for the mean-shift kernel</span>
00128         <span class="keyword">static</span> <span class="keywordtype">double</span>   min_mean_shift_err;
00129         <span class="keyword">static</span> <span class="keywordtype">double</span>   max_mean_shift_iter;
00130 };
00131 
00132 <span class="preprocessor">#endif // !defined( BODY_H )</span>
</pre></div><hr><address style="align: right;"><small>
Generated on Mon May 15 16:43:42 2006 for NewVision by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>
